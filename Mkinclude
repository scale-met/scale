ifeq ($(ENABLE_FIXEDINDEX),T)
   FFLAGS   += -D_FIXEDINDEX_
   inc_index = $(INDEX_DIR)/inc_index.h
   OBJ_DIR   = $(BUILD_DIR)
   INST_DIR  = $(BUILD_DIR)
else
   inc_index =
   OBJ_DIR   = .
   INST_DIR  = $(TOPDIR)
endif

ifeq ($(origin BINDIR), undefined)
   BINDIR = $(INST_DIR)/bin
endif

ifeq ($(origin LIBDIR), undefined)
   LIBDIR = $(INST_DIR)/lib
endif

ifeq ($(origin MODDIR), undefined)
   MODDIR = $(INST_DIR)/include
endif

GTOOLDIR    = $(TOPDIR)/gtool
DCUTILSDIR  = $(TOPDIR)/dc_utils
SCALELIBDIR = $(TOPDIR)/scalelib

SCALERMDIR  = $(TOPDIR)/scale-rm
SCALEGMDIR  = $(TOPDIR)/scale-gm

ifeq ($(origin INDEX_DIR), undefined)
   INDEX_DIR = $(SCALELIBDIR)/include
endif

ifeq ($(AGGRESSIVE),T)
   FFLAGS = $(FFLAGS_AGGRESSIVE) $(FFLAGS_SYSDEPEND)
   CFLAGS = $(CFLAGS_FAST)       $(CFLAGS_SYSDEPEND)
else
   ifeq ($(DEBUG),T)
      FFLAGS     = $(FFLAGS_DEBUG) $(FFLAGS_SYSDEPEND)
      FFLAGS_DYN = $(FFLAGS)
      CFLAGS     = $(CFLAGS_DEBUG) $(CFLAGS_SYSDEPEND)
   else
      ifeq ($(QUICKDEBUG),T)
         FFLAGS = $(FFLAGS_QUICKDEBUG) $(FFLAGS_SYSDEPEND)
         CFLAGS = $(CFLAGS_FAST)       $(CFLAGS_SYSDEPEND)
      else
         FFLAGS = $(FFLAGS_FAST)       $(FFLAGS_SYSDEPEND)
         CFLAGS = $(CFLAGS_FAST)       $(CFLAGS_SYSDEPEND)
      endif
   endif
endif

ifeq ($(SINGLE),T)
   FFLAGS += -DSINGLE
endif

# NetCDF setting
# These settings are inquired in order of:
# The environment variable->Makedef.XXX->here
NETCDF_INCLUDE ?= $(shell nf-config --fflags) $(shell nc-config --cflags)
NETCDF_LIBS    ?= $(shell nf-config --flibs)  $(shell nc-config --libs)

ifeq ($(ENABLE_PNETCDF),T)
   NETCDF_INCLUDE += -DPNETCDF
else
  ifeq ($(ENABLE_PNETCDF),)
    ifeq ($(shell nc-config --has-pnetcdf),yes)
      NETCDF_INCLUDE += -DPNETCDF
    endif
  endif
endif

ifeq ($(ENABLE_PAPI),T)
   FFLAGS      += -D_PAPI_
   PAPI_INCLUDE = -I$(PAPI)/include
   PAPI_LIBS    = -L$(PAPI)/lib -lpapi
endif

ifeq ($(USE_NETCDF3),T)
   CFLAGS += -DNETCDF3
endif

ifeq ($(ENABLE_MATHLIB),T)
   FFLAGS += -D_MATHLIB
endif

ifeq ($(CHECK_MASS),T)
   FFLAGS += -DCHECK_MASS
endif

# Super Droplet Method (SDM)
ifeq ($(ENABLE_SDM),T)
   FFLAGS         += -D_SDM $(ADDITIONAL_FFLAGS_SDM)
   GAGETRYDIR      = $(TOPDIR)/contrib/Gadgetry
   MTDIR           = $(TOPDIR)/contrib/mt
   SDMDIR          = $(TOPDIR)/contrib/SDM
   CONTRIB_LIBS    = $(LIBDIR)/libgagetry.a $(LIBDIR)/libmt.a $(LIBDIR)/libsdm.a
   CONTRIB_INCLUDE = -I$(GAGETRYDIR) -I$(MTDIR) -I$(SDMDIR)
else
   GAGETRYDIR      =
   MTDIR           =
   SDMDIR          =
   CONTRIB_LIBS    =
   CONTRIB_INCLUDE =
endif
