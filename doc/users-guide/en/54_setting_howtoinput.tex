\section{How to prepare initial and boundary data} \label{sec:adv_datainput}
%====================================================================================

\begin{table}[tbh]
\begin{center}
\caption{External input data supported in \scalelib}
\begin{tabularx}{150mm}{l|l|X} \hline
 \rowcolor[gray]{0.9} Data type   & \verb|FILETYPE_ORG|  & Note \\ \hline
 SCALE format   & \verb|SCALE-RM|     & History and restart files are supported. The latitude-longitude catalog is needed. \\ \hline
 Binary format  & \verb|GrADS|        & Another namelist for data input is required.    \\ \hline
 WRF format     & \verb|WRF-ARW|      & Both ``wrfout''  and``wrfrst'' are supported.\\ \hline
\end{tabularx}
\label{tab:inputdata_format}
\end{center}
\end{table}

\scalerm can generate initial and boundary data by entering various types of external data, as shown in Table \ref{tab:inputdata_format}.
The program \verb|scale-rm_init| converts external data into boundary and initial data by configuring the file \verb|init.conf|.
The input data format is specified at \nmitem{FILETYPE_ORG} in \namelist{PARAM_MKINIT_REAL_(ATMOS|OCEAN|LAND)}.

The SCALE format is mainly used for offline nesting.
Refer to Section \ref{subsec:nest_offline} for details.

The WRF data format is available; WRF model output data can be used directly.
Note that the file should contain all data required for the generation of the boundary data of \scalerm.

The ``binary format'' in this documentation is defined as binary data with single-precision floating points that FORTRAN can directly access.
Other format data, such as GRIB/GRIB2 data, should be converted to the binary format; this procedure is explained in Section \ref{sec:tutorial_real_data}.

Note that the format of output files in the latest version is different from that in the version 5.3 or older.
Therefore, the init/boundary files which are made in the version 5.3 or older can't be used in the current version (\scalelib \version).

%%%---------------------------------------------------------------------------------%%%%
\subsubsection{Settings common to SCALE format and Binary format} \label{sec:datainput_common_setting}
%%
The base name of the initial file to be output is set by \nmitem{RESTART_OUT_BASENAME} in \namelist{PARAM_RESTART} as follows:
%%
\editbox{
\verb|&PARAM_RESTART|\\
\verb| RESTART_OUTPUT       = .true.,|\\
\verb| RESTART_OUT_BASENAME = "init_d01",|\\
\verb|/|\\
}

The configurations for the input data are specified in \namelist{PARAM_MKINIT_REAL_(ATMOS|OCEAN|LAND)} in the configuration file \verb|init.conf| as follows:
%%
\editbox{
\verb|&PARAM_MKINIT_REAL_ATMOS|\\
\verb| NUMBER_OF_FILES            = 2,|\\
\verb| NUMBER_OF_TSTEPS           = 1, |\\
\verb| FILETYPE_ORG               = *The value depends on input data format*,|\\
\verb| BASENAME_ORG               = *The value depends on input data format*,|\\
\verb| BASENAME_BOUNDARY          = "boundary_d01",|\\
\verb| BOUNDARY_UPDATE_DT         = 21600.0,|\\
\verb| USE_FILE_DENSITY           = .false.,|\\
\verb| USE_NONHYDRO_DENS_BOUNDARY = .false.,|\\
\verb| USE_SFC_DIAGNOSES          = .false.,|\\
\verb| USE_DATA_UNDER_SFC         = .true.,|\\
\verb| INTRP_TYPE                 = 'LINEAR',|\\
\verb|/|\\
\verb|&PARAM_MKINIT_REAL_OCEAN|\\
\verb| NUMBER_OF_FILES      = 2,|\\
\verb| NUMBER_OF_TSTEPS     = 1, |\\
\verb| FILETYPE_ORG         = *The value depends on input data format*,|\\
\verb| BASENAME_ORG         = *The value depends on input data format*,|\\
\verb| INTRP_OCEAN_SFC_TEMP = "mask",|\\
\verb| INTRP_OCEAN_TEMP     = "mask",|\\
\verb|/|\\
\verb|&PARAM_MKINIT_REAL_LAND|\\
\verb| NUMBER_OF_FILES      = 2,|\\
\verb| NUMBER_OF_TSTEPS     = 1, |\\
\verb| FILETYPE_ORG         = *The value depends on input data format*,|\\
\verb| BASENAME_ORG         = *The value depends on input data format*,|\\
\verb| USE_FILE_LANDWATER   = .true.,|\\
\verb| INTRP_LAND_TEMP      = "fill",|\\
\verb| INTRP_LAND_WATER     = "fill",|\\
\verb| INTRP_LAND_SFC_TEMP  = "fill",|\\
\verb| ELEVATION_CORRECTION = .true.,|\\
\verb|/|\\
}

\nmitem{NUMBER_OF_FILES} is the number of input files. 
The program \verb|scale-rm_init| reads these files enumerated from \verb|00000| to the given number \nmitem{NUMBER_OF_FILES}-1.
\nmitem{NUMBER_OF_TSTEPS} is the number of time steps stored in each input file.

\nmitem{BOUNDARY_UPDATE_DT} is the time step of input data.
\nmitem{BASENAME_BOUNDARY} is the base name of the output boundary files.
If \nmitem{BASENAME_BOUNDARY} is not specified, no boundary files are output.
For example, in the above case, the boundary file(s) are created only for the atmospheric variables; the initial file is prepared for all atmospheric, ocean, and land variables.

\nmitem{INTRP_TYPE} is the type of horizontal interpolation.
``\verb|LINEAR|'' and ``\verb|DIST-WEIGHT|'' are valid for the type.
If it is ``\verb|LINEAR|'', the bi-linear interpolation is used, and distance-weighted mean of the nearest $N$-neighbors is used if it is ``\verb|DIST-WEIGHT|''.
In the case of ``\verb|DIST-WEIGHT|'', the number of the neighbors is set by \nmitem{COMM_CARTESC_NEST_INTERP_LEVEL} in \namelist{PARAM_COMM_CARTESC_NEST}.

The above configurations except for \nmitem{BASENAME_BOUNDARY} can be shared; 
if the items of namelist are not specified in \namelist{PARAM_MKINIT_REAL_(OCEAN|LAND)}, 
the values same as that in \namelist{PARAM_MKINIT_REAL_ATMOS} are used.

The calculation method for the density is specified by \nmitem{USE_FILE_DENSITY} and \nmitem{USE_NONHYDRO_DENS_BOUNDARY}. 
For the default setting where both of values are \verb|.false.|, the density in initial and boundary data is calculated with hydrostatic balance, i.e., $\frac{dp}{dz}=-\rho g$ from the input temperature and humidity data.
If \nmitem{USE_FILE_DENSITY} = \verb|.true.|, the density read from the input file(s) is used as well as the other variables. 
Regardless of the \nmitem{USE_FILE_DENS}, if \nmitem{USE_NONHYDRO_DENS_BOUNDARY} = \verb|.true.|, , 
using the equation of state, i.e., $\rho = p/RT$ and the input temperature, pressure, and humidity data, the density of boundary data is calculated (the initial data is not affected).
This density is generally consistent with that in the parent model. 
% The densities in the initial and boundary data become different if \nmitem{USE_FILE_DENSITY}=\verb|.false.| and \nmitem{USE_NONHYDRO_DENS_BOUNDARY} = \verb|.true.|.
The reason why these boundary options are provided is the following.
In most cases, the density satisfying the hydrostatic balance is preferred for the initial data to reduce initial shock in the simulation.
Therefore, \nmitem{USE_FILE_DENSITY}=\verb|.false.| is recommended. 
On the other hand, since the density constructed with the hydrostatic balance could differ from that in the parent model (or realistic value), this may cause a significant mass bias in the simulation.
In such cases, in terms of representation of the simulation such as pressure field, it could be better to use consistent density with the parent's one using \nmitem{USE_NONHYDRO_DENS_BOUNDARY}=\verb|.true.|.
The vertical acceleration or waves due to the use of hydrostatically inbalanced density as the boundary data is expected to be quickly dumped by the lateral nudging.


\nmitem{USE_SFC_DIAGNOSES} is the switch of the calculation way for the values at the \scale layers below the lowermost grid of the input data.
If \nmitem{USE_SFC_DIAGNOSES} = \verb|.true.|, the surface quantities, such as T2, RH2, U10, V10, and PSFC are used.
Otherwise, constant potential temperature and hydrostatic balance are assumed.

\nmitem{USE_DATA_UNDER_SFC} is switch whether the input data below its surface is used or ignored.
%The data below the surface may appear on a high-pressure surface at high mountainous region.

The soil water is configured by \nmitem{USE_FILE_LANDWATER} of \namelist{PARAM_MKINIT_REAL_LAND} in \verb|init.conf|.
There are two options in preparation of soil moisture: i) the data provided from the input file (\nmitem{USE_FILE_LANDWATER} = \verb|.true.|) and ii) a constant value in the entire region (\nmitem{USE_FILE_LANDWATER} = \verb|.false.|).
In the case of the option i), either \verb|SMOISVC| or \verb|SMOISDS| as the 3D soil moisture data is required.
The fraction of volume of soil moisture (\verb|SMOISVC|) is the ratio of water volume ($V_w$) to soil volume ($V$), i.e., $V_w / V$.
The saturation ratio (\verb|SMOISDS|) is the ratio of water volume $V_w$ to void spaces in $V$, i.e., $V_w / V_v$.
%
In the case of the option ii), the saturation ratio is specified by \nmitem{INIT_LANDWATER_RATIO}.
The default value is 0.5.
The porosity of the soil depends on the land use.
\editboxtwo{
\verb|&PARAM_MKINIT_REAL_LAND| &\\
\verb| USE_FILE_LANDWATER   = .false.| & whether or not soil moisture is given by file. The default is \verb|.true.| \\
\verb| INIT_LANDWATER_RATIO = 0.5    | & in the case of \verb|USE_FILE_LANDWATER=.false.| \\
                                       & degree of saturation\\
\verb|  ..........                   | & \\
\verb|/| & \\
}

%%%---------------------------------------------------------------------------------%%%%
\subsubsection{Input from SCALE format data} \label{sec:datainput_scale}

For the SCALE format data, the configurations specified in \namelist{PARAM_MKINIT_REAL_(ATMOS|OCEAN|LAND)} are as follows:
\editbox{
\verb|&PARAM_MKINIT_REAL_ATMOS|\\
... \\
\verb| FILETYPE_ORG               = "SCALE-RM",|\\
\verb| BASENAME_ORG               = "history_d01",|\\
\verb| SAME_MP_TYPE               = .false.,|\\
... \\
\verb|/|\\
\verb|&PARAM_MKINIT_REAL_OCEAN|\\
... \\
\verb| FILETYPE_ORG         = "SCALE-RM",|\\
\verb| BASENAME_ORG         = "history_d01",|\\
... \\
\verb|/|\\
\verb|&PARAM_MKINIT_REAL_LAND|\\
... \\
\verb| FILETYPE_ORG         = "SCALE-RM",|\\
\verb| BASENAME_ORG         = "history_d01",|\\
... \\
\verb|/|\\
}

\nmitem{FILETYPE_ORG} is set to \verb|"SCALE-RM"|. 
The base name of input files is specified by \nmitem{BASENAME_ORG}.  
Given \verb|BASENAME_ORG="history_d01"|, the input file should be named \verb|history_d01.nc| when the number of input file is 1. 
When the number of input files is larger than 1 or \nmitem{BASENAME_ADD_NUM} = \verb|.true.| in \namelist{PARAM_RESTART}, 
the name of the input files should be numbered as \verb|"history_d01_XXXXX.nc"|. 

If cloud microphysical scheme used is same as that in the parent model, specify \nmitem{SAME_MP_TYPE}. 


%%%---------------------------------------------------------------------------------%%%%
\subsubsection{Input from binary format data} \label{sec:datainput_grads}

\nmitem{ELEVATION_CORRECTION} in \namelist{PARAM_MKINIT_REAL_LAND} determines
whether soil temperature and land surface temperature for the initial and boundary data are corrected
according to the topographical difference between the parent model and the \scalerm.
In general, topographies of the parent model and the \scalerm are different.
Therefore, if soil temperature and land surface temperature for the initial and boundary data are made by simply interpolating the data of the parent model,
there could be inconsistency of temperature according to the height difference of the topography.
If \nmitem{ELEVATION_CORRECTION} is \verb|.true.|,
soil temperature and land surface temperature for the initial and boundary data are corrected according to the height difference.
For example, if the topography made by the \scalerm is $\Delta h$ higher than that of the parent model,
soil temperature and land surface temperature are uniformly reduced by $\Delta h\Gamma$,
where $\Gamma$ is lapse rate of the international standard atmosphere (ISA): $\Gamma=6.5\times 10^{-3}$ [K/m].
The default value is \nmitem{ELEVATION_CORRECTION} = \verb|.true.|.



The following is an example of the namelist file \verb|namelist.grads_boundary**| providing information of the data file name and data structure.
\editbox{
\verb|#| \\
\verb|# Dimension    |  \\
\verb|#|                \\
\verb|&GrADS_DIMS|  \\
\verb| nx     = 360,|~~~   ; default value of the number of grids in the x direction \\
\verb| ny     = 181,|~~~   ; default value of the number of grids in the y direction \\
\verb| nz     = 26, |~~~~~ ; default value of the number of layers in the z direction \\
\verb|/|                \\
\\
\verb|#              |  \\
\verb|# Variables    |  \\
\verb|#              |  \\
\verb|&GrADS_ITEM  name='lon',     dtype='linear',  swpoint=0.0d0,   dd=1.0d0 /  |  \\
\verb|&GrADS_ITEM  name='lat',     dtype='linear',  swpoint=90.0d0,  dd=-1.0d0 / |  \\
\verb|&GrADS_ITEM  name='plev',    dtype='levels',  lnum=26,| \\
~~~\verb|      lvars=100000,97500,.........,2000,1000, /     |  \\
\verb|&GrADS_ITEM  name='HGT',     dtype='map',     fname='FNLatm', startrec=1,  totalrec=125 / |  \\
\verb|&GrADS_ITEM  name='U',       dtype='map',     fname='FNLatm', startrec=27, totalrec=125 / |  \\
\verb|&GrADS_ITEM  name='V',       dtype='map',     fname='FNLatm', startrec=53, totalrec=125 / |  \\
\verb|&GrADS_ITEM  name='T',       dtype='map',     fname='FNLatm', startrec=79, totalrec=125 / |  \\
\verb|&GrADS_ITEM  name='RH',      dtype='map',     fname='FNLatm', startrec=105,totalrec=125, nz=21 /  |  \\
\verb|&GrADS_ITEM  name='MSLP',    dtype='map',     fname='FNLsfc', startrec=1,  totalrec=9   / |  \\
\verb|&GrADS_ITEM  name='PSFC',    dtype='map',     fname='FNLsfc', startrec=2,  totalrec=9   / |  \\
\verb|&GrADS_ITEM  name='SKINT',   dtype='map',     fname='FNLsfc', startrec=3,  totalrec=9   / |  \\
\verb|&GrADS_ITEM  name='topo',    dtype='map',     fname='FNLsfc', startrec=4,  totalrec=9   / |  \\
\verb|&GrADS_ITEM  name='lsmask',  dtype='map',     fname='FNLsfc', startrec=5,  totalrec=9  /  |  \\
\verb|&GrADS_ITEM  name='U10',     dtype='map',     fname='FNLsfc', startrec=6,  totalrec=9   / |  \\
\verb|&GrADS_ITEM  name='V10',     dtype='map',     fname='FNLsfc', startrec=7,  totalrec=9   / |  \\
\verb|&GrADS_ITEM  name='T2',      dtype='map',     fname='FNLsfc', startrec=8,  totalrec=9   / |  \\
\verb|&GrADS_ITEM  name='RH2',     dtype='map',     fname='FNLsfc', startrec=9,  totalrec=9   / |  \\
\verb|&GrADS_ITEM  name='llev',    dtype='levels',  nz=4, lvars=0.05,0.25,0.70,1.50, /        |  \\
~~~~~~~~\verb| missval=9.999e+20 /|  \\
\verb|&GrADS_ITEM  name='STEMP',   dtype='map',     fname='FNLland', nz=4, startrec=1, totalrec=8,|\\
~~~~~~~~\verb| missval=9.999e+20 /|  \\
\verb|&GrADS_ITEM  name='SMOISVC', dtype='map',     fname='FNLland', nz=4, startrec=5, totalrec=8,|\\
~~~~~~~~\verb| missval=9.999e+20 /|  \\
}

The default value of the number of grids is specified as \verb|nx, ny, nz| in \namelist{GrADS_DIMS}.
Configurations for the variables are individually specified by \namelist{GrADS_ITEM}.
The explanations of \namelist{GrADS_ITEM} is described in Table \ref{tab:namelist_grdvar}.

The base name of input files is set as \verb|fname| in the \namelist{GrADS_ITEM}.
Given the base name is set as \verb|fname="filename"|, the input binary data file should be named  \verb|filename.grd| in the case that the number of the input binary file is one.
In the case that the number of input files is larger than 1 or \nmitem{BASENAME_ADD_NUM} = \verb|.true.| in \namelist{PARAM_RESTART}, 
prepare the files numbered as \verb|"filename_XXXXX.grd"|.

If the number of grids is different from the default value, specify the number in \namelist{GrADS_ITEM}.
For example, the \verb|QV| and \verb|RH| in upper levels are not always available.
In such cases, the number of layers where the data exist is specified as \verb|nz|.
Then, two methods to extrapolate values to the upper layers in \scale are prepared:
\verb| upper_qv_type = "ZERO"| is default.
\editboxtwo{
\verb|&PARAM_MKINIT_REAL_GrADS| & \\
\verb| upper_qv_type = "ZERO"| & \verb|"ZERO"|: QV=0 \\
                               & \verb|"COPY"|: copy the RH at the top layer where input humidity data exists to the upper layers without the data\\
\verb|/|\\
}



The variables required for the \scalerm calculation are listed in Table \ref{tab:grdvar_item}.


{\small
\begin{table}[tbh]
\begin{center}
\caption{Variables of \namelist{GrADS_ITEM}}
\label{tab:namelist_grdvar}
\begin{tabularx}{150mm}{llX} \hline
\rowcolor[gray]{0.9}
item of \verb|GrADS_ITEM|      & Explanation    & Note \\ \hline
name                        & Variable name  & Select from Table \ref{tab:grdvar_item}   \\
dtype                       & Data type      & \verb|"linear"|,\verb|"levels"| or \verb|"map"| \\\hline
\multicolumn{3}{X}{namelist at \nmitem{dtype}\verb|="linear"| (Specific use of \verb|"lon", "lat"| )} \\ \hline
fname     & Header name of files           &  \\
swpoint                     & Value of start point &  \\
dd                          & Increment            &  \\ \hline
\multicolumn{3}{X}{namelist at \nmitem{dtype}\verb|"=levels"| (Specific use of \verb|"plev", "llev"|)} \\ \hline
lnum      & Number of levels (layers )     &  \\
lvars     & Values of each layer           &  \\ \hline
\multicolumn{3}{X}{namelist at \nmitem{dtype}\verb|="map"|}           \\ \hline
startrec  & Recorded number of variables \nmitem{item}     &  time at t=1\\
totalrec  & Recorded length of all variables per time  &  \\
missval  & missing value     & (option) \\ \hline
nx       & Number of grids in the x directions & (option) \\ \hline
ny       & Number of grids in the y directions & (option) \\ \hline
nz       & Number of layers in the z directions & (option) \\ \hline
yrev     & If the data is stored from the north to south, set \verb|.true.| & (option) \\ \hline
\end{tabularx}
\end{center}
\end{table}
}

{
\begin{table}[bth]
\begin{center}
\caption{Variable list of \nmitem{name} in \namelist{GrADS_ITEM}. The asterisk means ``it is optional but recommended as possible''. The double-asterisk means ``it is available but not recommended''.}
\label{tab:grdvar_item}
\small
\begin{tabularx}{150mm}{rl|l|l|l} \hline
 \rowcolor[gray]{0.9} & Variable name & Explanation & Unit & \nmitem{dtype} \\ \hline
           &\verb|lon|     & longitude data                   & [deg.]         & \verb|linear, map| \\
           &\verb|lat|     & latitude data                    & [deg.]         & \verb|linear, map| \\
           &\verb|plev|    & pressure data                    & [Pa]           & \verb|levels, map| \\
           &\verb|HGT|     & geopotential height data         & [m]            & \verb|map|         \\
    $\ast$ &\verb|DENS|    & air density                      & [kg/m3]        & \verb|map|         \\
           &\verb|U|       & eastward wind speed              & [m/s]          & \verb|map|         \\
           &\verb|V|       & northward wind speed             & [m/s]          & \verb|map|         \\
$\ast\ast$ &\verb|W|       & vertical wind speed              & [m/s]          & \verb|map|         \\
           &\verb|T|       & temperature                      & [K]            & \verb|map|         \\
           &\verb|RH|      & relative humidity                & [\%]           & \verb|map|         \\
           &               & (optional if QV is given)        &                &                    \\
           &\verb|QV|      & specific humidity                & [kg/kg]        & \verb|map|         \\
           &               & (optional if RH is given)        &                &                    \\
$\ast\ast$ &\verb|QC|      & ratio of cloud water mass        & [kg/kg]        & \verb|map|         \\
$\ast\ast$ &\verb|QR|      & ratio of rain water mass         & [kg/kg]        & \verb|map|         \\
$\ast\ast$ &\verb|QI|      & ratio of cloud ice mass          & [kg/kg]        & \verb|map|         \\
$\ast\ast$ &\verb|QS|      & ratio of snow mass               & [kg/kg]        & \verb|map|         \\
$\ast\ast$ &\verb|QG|      & ratio of graupel mass            & [kg/kg]        & \verb|map|         \\
$\ast\ast$ &\verb|MSLP|    & sea level pressure               & [Pa]           & \verb|map|         \\
$\ast\ast$ &\verb|PSFC|    & surface pressure                 & [Pa]           & \verb|map|         \\
$\ast\ast$ &\verb|U10|     & eastward 10m wind speed          & [m/s]          & \verb|map|         \\
$\ast\ast$ &\verb|V10|     & northward 10m wind speed         & [m/s]          & \verb|map|         \\
$\ast\ast$ &\verb|T2|      & 2m temperature                   & [K]            & \verb|map|         \\
$\ast\ast$ &\verb|RH2|     & 2m relative humidity             & [\%]           & \verb|map|         \\
           &               & (optional if Q2 is given)        &                &                    \\
$\ast\ast$ &\verb|Q2|      & 2m specific humidity             & [kg/kg]        & \verb|map|         \\
           &               & (optional if RH2 is given)       &                &                    \\
    $\ast$ &\verb|TOPO|    & topography of GCM                & [m]            & \verb|map|         \\
    $\ast$ &\verb|lsmask|  & ocean--land distribution of GCM  & 0:ocean,1:land & \verb|map|         \\
           &\verb|SKINT|   & surface temperature              & [K]            & \verb|map|         \\
           &\verb|llev|    & soil depth                       & [m]            & \verb|levels|      \\
           &\verb|STEMP|   & soil temperature                 & [K]            & \verb|map|         \\
           &\verb|SMOISVC| & soil moisture (volume fraction)  & [-]            & \verb|map|         \\
           &               & (optional if SMOISDS is given)   &                &                    \\
           &\verb|SMOISDS| & soil moisture (saturation ratio) & [-]            & \verb|map|         \\
           &               & (optional if SMOISVC is given)   &                &                    \\
           &\verb|SST|     & sea surface temperature          & [K]            & \verb|map|         \\
           &               & (optional if SKINT is given)     &                &                    \\\hline
\end{tabularx}
\end{center}
\end{table}
}
