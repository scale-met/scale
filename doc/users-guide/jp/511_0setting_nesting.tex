\section{\SecAdvanceNesting} \label{sec:nest_exp}
%====================================================================================

ネスティングとは、水平格子間隔の異なる複数の計算領域を
領域が重複するように入れ子（ネスト）構造に設定する計算領域設定方法である。
図\ref{fig_nestsample}では、3つの領域を用いた3段ネスティングの例を示している。
外側の領域は、大きな空間スケールの現象を表現するため、低い水平解像度で広い領域を設定し、
内側の領域は、細かい現象を解像するために、狭い範囲であるが高い水平解像度に設定する。
内側の領域は、外側の領域の計算結果を境界値データとして用いる。
ここでは、入れ子構造のうち、
データを渡す側の領域を「親領域」、データを受ける側の領域を「子領域」と呼ぶことにする。

ネスティングの手法として、下記の種類に分けることができる。
\begin{itemize}
\item 実行方法
\begin{description}
 \item[オンライン・ネスティング]\mbox{}\\
計算の途中で、親領域と子領域の計算結果を逐次やりとりしながら親領域と子領域の計算を同時に実行する方法。
 \item[オフライン・ネスティング]\mbox{}\\
まず最初に親領域の時間積分を行う。その後、親領域の出力結果を用いて子領域用の初期値・境界値を作成し、
子領域の計算を行う方法。
\end{description}
\item データの受け渡し方法
\begin{description}
 \item[一方向ネスティング]\mbox{}\\
親領域のデータは子領域に受け渡されるが、子領域の計算結果は親領域に渡されない。
つまり、データの流れは親領域から子領域に向かう一方通行。親領域は子領域の結果の影響を受けない。
 \item[双方向ネスティング]\mbox{}\\
親領域のデータは子領域へ、子領域の計算結果は親領域にフィードバックされる。
親領域の計算に、子領域の計算結果が反映される。
(オンランイン・ネスティング時のみ適用可能であるが、{\scalerm} v{\version} では実装されていない。)
\end{description}
\end{itemize}

オンラインとオフラインの違いは、子領域の境界条件に与えられる親領域の情報の更新頻度にある。
\scalerm はオフライン・ネスティング実験とオンライン・ネスティング実験の両方をサポートしている。
オンラインの場合、
子領域の境界条件の更新は親領域のタイムステップ($\Delta t$) 毎に行われるが、
オフラインの場合、親領域のhitoryファイルの出力間隔に依存する。

親領域と子領域の間の格子間隔の比（$\mathrm{DX}_{\mathrm{d01}}/\mathrm{DX}_{\mathrm{d02}}$）は、
オフライン、オンラインに関わらずシステム上の制限はないが、
この比率が大きすぎると計算結果の物理的なパフォーマンスが下がる可能性がある。
\scalerm では5倍以下で使用することを推奨する。

本節、以降の説明では、
親領域の設定ファイルを\verb|***.d01.conf| 、
子領域の設定ファイルを\verb|***.d02.conf| と表記する。

\begin{figure}[t]
\begin{center}
  \includegraphics[width=1.0\hsize]{./figure/nesting_sample.eps}\\
  \caption{日本の近畿地方を対象領域とした領域ネスティング設定の例。 
    domain 1が最外領域でdomain 3が最内領域である。
    赤い矩形と線は、それぞれの位置関係を示している。domain 1の水平格子間隔は7.5 km、domain 2は2.5 km、
    そしてdomain 3は0.5 kmである。}
  \label{fig_nestsample}
\end{center}
\end{figure}


