%\section{Surface flux}
{\bf \Large
\begin{tabular}{ccc}
\hline
  Corresponding author & : & Yousuke Sato\\
\hline
\end{tabular}
}
\\
 The SCALE-LES has three types of cloud microphysics models. We will show description of these models below.

\subsection{Kessler Parameterization}
An one-moment bulk microphysical scheme, which treats only warm cloud (cloud and rain), is implemented in SCALE. This scehem predicts mixing ratio of cloud ($Q_{cloud}$) and rain ($Q_{rain}$). Cloud microphysical processes treated in this scheme is saturation adjustment (corresponding to nucleatioin, evaporation, and condensation of cloud), evaporation, auto-conversion, accretion, and sedimentation. The tendency of $Q_{cloud}$, $Q_{rain}$, and $Q_{v}$ (vapor mixing ratio) is given as

\begin{eqnarray}
\frac{\partial Q_{cloud}}{\partial t}&=&dQ|_{sat}-dQ|_{auto}-dQ|_{acc}\\
\frac{\partial Q_{rain}}{\partial t}&=&dQ|_{auto}+dQ|_{acc}-dQ|_{evap}-F_{Q_{r}}|_{sed}\\
\frac{\partial Q_{v}}{\partial t}&=&dQ|_{evap}-dQ|_{sat}
\end{eqnarray}

where $dQ|_{sat}$, $dQ|_{auto}$, $dQ|_{acc}$, and $dQ|_{evap}$ represents tendency of mixing ratio by saturation adjustment, auto-conversion, accretion, and evaporation, respectively. $F_{Q_{r}}|_{sed}$ represents flux of $Q_{r}$ by sedimentation.\\ $dQ|_{auto}$, $dQ|_{acc}$, and $dQ|_{evap}$ are given as

\begin{eqnarray}
dQ_{auto}&=&\left\{
\begin{array}{ll}
Q_{cloud}*10^{-3} & (Q_{cloud}>10^{-3})\\
0 & (else)\\
\end{array}\right.\\
dQ_{acc}&=&2.2\times Q_{cloud}\times Q_{rain}^{0.875}\\
dQ_{evap}&=&\left\{
\begin{array}{ll}
f_{vent} \frac{q_{s}-Q_{cloud}}{q_{s}\rho}\frac{(\rho*Q_{rain})^{0.525}}{5.4\times 10^{5}+\frac{2.55\times 10^{8}}{pq_{s}}} & ( q_{s} > Q_{cloud})\\
0 & (else)\\
\end{array} \right.
\end{eqnarray}

where $f_{vent}$ is ventiration factor ($f_{vent}=1.6+124.9(\rho Q_{rain})^{0.2046}$), and unit of $dQ_{***}$ is [kg/kg/s]. $p$, $q_{s}$, and $\rho$ is pressure, saturation vapor mixing ratio, and total density.\\
The $dQ|_{sat}$ is given as

\begin{eqnarray}
dQ|_{sat}=Q_{v}-q_{s}.
\end{eqnarray}

Terminal velocity of cloud ($V_{t,c}$) and rain ($V_{t,r}$) is given as

\begin{eqnarray}
V_{t,c}&=&0\\
V_{t,r}&=&36.34(\rho Q_{rain})^{0.1364} [m/s]
\end{eqnarray}



\subsection{Double-Moment Bulk\cite{sn_2013}}

\subsubsection{Treatment of hydrometeors}
Generally, characteristics of cloud particles are determined by their size, shape and chemical properties of solute in them. Representation of these characteristics needs a multi-dimensional parameter space of size, shape and chemical compositions. Since development of a cloud resolving model (CRM) coupled with an aerosol transport model is beyond the scope of this study, we consider a two-dimensional parameter space of size and shape of cloud particles. We then categorize cloud models into two major groups according to their representation of cloud particles. One is the bin method, with discretized particle size bins, predicting the population density of particles in each bin. The other is the bulk method in which the particle size distributions are approximated by several prescribed modes, predicting the total populations of partilces of each mode. The treatment of hydrometeors adopted in this study is described in the following sections.

\subsubsection{Droplet Size Distribution}
The Seiki and Nakajima (2014)\cite{sn_2013} scheme is designed to maintain the self-consistency of the assumptions regarding droplet size distribution (DSD) and the shapes of ice particles among the cloud microphysical processes. Following Seifert and Beheng (2006; hereafter, SB06), Seiki and Nakajima(2014)\cite{sn_2013} predicts the moments of the DSDs of each hydrometeor assuming the generalized gamma distribution to analytically formulate the cloud microphysics as follows:

\begin{eqnarray}
f_{a}(r)=\alpha_{a}x^{\nu_{a}}\exp(-\lambda x)
\label{sn7}
\end{eqnarray}

where the index a $\in$ (c,r,i,s,g) represents cloud water, rain, cloud ice, snow, and graupel. For a given DSD, the k-th moment of a DSD can be defined as follows:

\begin{eqnarray}
M^{(k)}_{a}\equiv \int_{0}^{\infty}x^{k}f_{a}(r)dx,\;\;(k\in {\bf R})
\label{sn8}
\end{eqnarray}

For example, the 0-th moment of a DSD is the number concentration $N_{a}$, and the 1st moment of a DSD is the mass concentration $L_{a} = \rho q_{a}$. The evolutions of DSDs are represented by updating $\alpha_{a}$ and $\lambda_{a}$ using $N_{a}$ and $L_{a}$ with two fixed parameters, $\nu_{a}$ and $\mu_{a}$, respectively. The diagnostic parameters $\alpha_{a}$ and $\lambda_{a}$ are calculated as follows:

\begin{eqnarray}
\alpha_{a}=\frac{\mu_{a}\lambda_{a}}{\Gamma\Bigl(\frac{\nu_{a}+1}{\mu_{a}}\Bigr)}\lambda_{a}^{\frac{\nu_{a}+1}{\mu_{a}}}\\
\label{sn9}
\lambda_{a}=\Bigl[\frac{\Gamma\Bigl(\frac{\nu_{a}+1}{\mu_{a}}\Bigr)}{\Gamma\Bigl(\frac{\nu_{a}+2}{\mu_{a}}\Bigr)}\Bigr]^{-\nu_{a}}\nonumber
\end{eqnarray}

where the mean particle mass $\bar{x}\equiv L_{a}/N_{a}$. We maintain the self-consistency of the shape of ice particles by assuming power law relationships between: 1) the particle mass and the maximum dimension D and 2) the particle mass and the projected area to the flow A as follows:

\begin{eqnarray}
D&=&a_{m}x^{b_{m}}\\
\label{sn10}
A&=&a_{ax}x^{b_{m}}
\label{sn11}
\end{eqnarray}

where $a_{m}$, $b_{m}$, $a_{ax}$, and $b_{ax}$ are constant coefficients. We chose to use constant parameters in the representations of DSDs following SB06 for cloud water, cloud ice, snow, and graupel; and following Seifert (2008) for rain (assuming the collisional-breakup equilibrium condition). The shapes of ice particles are those given by Mitchell (1996) assuming cloud ice as hexagonal plates, snow as assemblages of planer polycrystals in cirrus clouds, and graupel as lump graupel. The abovementioned constant parameters for each hydrometeor are summarized in Table \ref{table_sn14-1}.

\begin{table}[h]
\begin{center}
\caption{Constant parameters chosen for the generalized gamma distribution; power law coefficients used for maximum dimensions and the projected area; and ranges of lower- and upper limits of mean mass.}
\label{table_sn14-1}
\scalebox{0.85}{
\begin{tabular}{cccccc}
\hline
                         & cloud water   & rain    & cloud ice   & snow   & graupel   \\ \hline\hline
$\nu$                    & 1  & -1/3 & 1 & 1 & 1 \\ \hline
$\mu$                    & 1  &  1/3 & 1/3   & 1/3   & 1/3   \\ \hline
$a_{m}$[m $kg^{-bm}$]    & 0.124   & 0.124   & 1.24   & 1.24   & 0.346   \\ \hline
$b_{m}$                  & 1/3 & 1/3 & 0.408   & 0.408   & 0.357 \\ \hline
$a_{ax}$[$m^{2}$$kg^{-bA}$]    & 0.0121   & 0.0121   & 0.178   & 0.196   & 0.0599   \\ \hline
$b_{ax}$ & 2/3 & 2/3 & 0.755   & 0.768   & 0.714 \\ \hline
$\bar{x_{min}}[kg]$ & $4.2\times 10^{-12}$ & $4.2\times 10^{-12}$ & $4.2\times 10^{-12}$ & $4.2\times 10^{-12}$ & $4.2\times 10^{-12}$ \\ \hline
$\bar{x_{max}}[kg]$ & $2.6\times 10^{-10}$ & $2.6\times 10^{-10}$ & $2.6\times 10^{-10}$ & $2.6\times 10^{-10}$ & $2.6\times 10^{-10}$ \\ \hline
\end{tabular}
}
\end{center}
\end{table}

\subsubsection{Terminal velocity of hydrometeors}
In the same manner as in Seifert and Beheng (2006a), the terminal velocities of particles are formulated in power laws except for the gravitational sedimentation which is described in accurate formula, because the gravitational sedimentation is directly compared with precipitation data. The terminal velocities of hydrometeors are determined by the balance between the drag force and gravitational force. Traditionally, the terminal velocity for small spherical particles, small Reynolds number ($N_{Re}$), are described by Stokes’ Law,

\begin{eqnarray}
\nu_{t,stokes}(r)=\frac{2g(\rho_{w}-\rho)}{9\eta_{a}}r^{2}
\label{sn12}
\end{eqnarray}

where $g$ = 9.80616 $[m s^{-2}]$ is the gravitational acceleration, $\rho w$ = 1000 $kg m^{-3}$ is the density of liquid water, $\rho$ is the density of air and $\eta_{a}$ is the dynamic viscosity of air. Laboratory experiments showed that the terminal velocity departed from Stokes’ Law as the Reynolds number increases (Gunn and Kinzer, 1948; Beard and Pruppacher, 1969). Thus, other formulas are required for larger droplets such as rain droplets and ice crystals.\\
In the case of liquid water droplets, the terminal velocity is well determined by laboratory experiments because of simplicity of the shape. In contrast, in the case of ice particles, there are many observation data of the terminal velocity for various shapes of ice crystals. Bohm (1989), Bohm (1992) and Mitchell (1996) proposed the general formulations of the terminal velocities of ice particles based on the boundary layer theory and their studies showed good agreement with observational data. In this study, we calculated terminal velocities for each ice particle based on Mitchell (1996) and then made a fitting curve by a power law in the suitable range of diameter. \\
In the theoretical formulas, the terminal velocities of hydrometeors are dependent on diameter, shape, the Reynolds number and the Best (or Davies) number ($N_{X}$). Application of these dependencies to cloud microphysics are so complicated that here we have applied a simplified approach suggested by Beard (1980),\\
1. The terminal velocity is calculated for the reference atmosphere.\\
2. The terminal velocity in the atmosphere are adjusted from the reference value.\\
In the following paragraphs, we describe the terminal velocities for the reference atmosphere and the adjustment technique.

\subsubsection{Terminal velocity of liquid water droplets for the reference atmosphere}
In the case of liquid water droplets, absence of shape variability makes formulation easier than ice particles. Here, we only consider the dependency on the diameter of droplets. Seifert and Beheng (2006) applied the formulation of Rogers et al. (1993), which is the analytical approximation to the observation data of Gunn and Kinzer (1948),

\begin{eqnarray}
\nu_{t}(D)=
\left\{
\begin{array}{l}
a_{R_{s}}D(1-exp(-b_{R_{s}}D)),\;\;(D<D_{0,r}) \\
a_{R_{l}}-b_{R_{l}}exp(-c_{R_{l}}D),\;\;(D>D_{0,r}) \\
\label{sn14}
\end{array}
\right.
\end{eqnarray}

where $a_{R_{s}} = 4000 s^{-1}$, $b_{R_{s}}=12000 m^{-1}$, $a_{R_{l}}=9.65 m s^{-1}$, $b_{R_{l}} = 10.43 m s^{-1}$, $c_{R_{l}} = 600 m^{-1}$, and $D_{0}$, $r=7.45\times10^{-4}$ m. This formulation approaches the quadratic form of Stokes’ Law in the limit for small diameter. In addition, the data of Gunn and Kinzer (1948) agrees well with the terminal velocities calculated by theoretical formulation based on the boundary layer theory (Bohm, 1992). Therefore, we applied eq.\ref{sn14} for the sedimentation of rain (Fig. \ref{figsn2-11}2 11). Here it is mentioned that the reference atmosphere of the formulation is $T = 293 K$, $p = 1000hPa$, and relative humidity is 0.5 (Gunn and Kinzer, 1948).

\subsubsection{Terminal velocity of solid water particles for the reference atmosphere}
In the case of ice particles, we derive the theoretical formulation of the terminal velocity following to Mitchell (1996). In general the aerodynamic drag force $F_{D}$ on a particle is expressed as follows,

\begin{eqnarray}
F_{D}\equiv \frac{1}{2}\rho\nu_{t}^{2}AC_{D}
\label{sn14}
\end{eqnarray}

where $C_{D}$ is the drag coefficient. Terminal velocity is determined by the equilibrium condition between the drag force and the gravitational acceleration,

\begin{eqnarray}
\nu_{t}=\bigl(\frac{2xg}{\rho AC_{D}}\bigr)^{1/2}
\label{sn15}
\end{eqnarray}

The problem of derivation of the terminal velocity is reduced to derivation of the drag coefficient indepenently on the terminal velocity. In practice, Mitchell (1996) and many other researchers calculated the terminal velocity by the definition of the Best number ($N_{X}$) as follows,

\begin{eqnarray}
N_{x}\equiv C_{D}N_{R_{e}}^{2}=\frac{2xg\rho D^{2}}{A\eta_{a}^{2}}
\label{sn16}
\end{eqnarray}

Where $N_{R_{e}}$ is the Reynolds number. The terminal velocity can be calculated after the relationship between the Best number and the Reynolds number is determined. In the relationship, it is convenient that the drag coefficient is determined by the Reynolds number although the dependency of the drag coefficient is complicated. A theoretical formulation of the drag coefficient was proposed by Abraham (1970). The drag coefficient is the dimensionless number defined by the drag force, the dynamic pressure and the projection area of the particle (see eq.\ref{sn14}). Abraham (1970) assumed that the effective projection area of the particle contained the projection area of the particle itself and also the boundary layer surrounding the particle as follows,


\begin{eqnarray}
F_{D}=\frac{1}{2}\rho \nu_{t}^{2}C_{0}A\bigl(1+\frac{\delta_{b}}{r_{A}}\bigl)^{2}
\label{sn17}
\end{eqnarray}

where $C_{0}$ is the drag coefficient which is due to the pressure of the fluid and should be determined independently of the shape, $\delta_{b}$ is the boundary layer depth and $r_{A}$ is the radius of a circle with the equivalent projection area. Furthermore, the ratio of the boundary layer depth to the radius is expressed as follows,

\begin{eqnarray}
\frac{\delta_{b}}{r_{A}}=\frac{\delta_{0}}{N_{R_{e}}^{1/2}}
\label{sn18}
\end{eqnarray}

where $\delta_{0}$ is non-dimensional constant. Substituting eq.\ref{sn18} into eq.\ref{sn17}, the drag coefficient which also includes the effect of the boundary layer is corresponding to the following,

\begin{eqnarray}
C_{D}=C_{0}\bigl(1+\frac{\delta_{0}}{N_{R_{e}}^{1/2}}\bigr)^{2}
\label{sn19}
\end{eqnarray}

Thus the drag coefficient is expressed by the Reynolds number. The relationship between the Reynolds number and the Best number is derived by substituting eq.\ref{sn19} into eq.\ref{sn16}

\begin{eqnarray}
N_{R_{e}}=\frac{\delta_{0}^{2}}{4}\Bigl[\bigr(1+\frac{4N_{X}^{1/2}}{\delta_{0}^{2}C_{0}^{1/2}}\bigr)^{1/2}-1 \bigr]^{2}
\label{sn20}
\end{eqnarray}

Here we use $C_{0}$ = 0.6 and $\delta_{0}$ = 5.83 as provided by Bohm (1989). Finally the terminal velocity of ice particles is calculated by substituting eq.\ref{sn16} and eq.\ref{sn20} into the definition of the Reynolds number,

\begin{eqnarray}
\nu_{t}&=&\frac{N_{Re}\eta_{a}}{D\rho}\nonumber\\
&=&\frac{\eta_{a}}{D\rho}\frac{\delta_{0}^{2}}{4}\Bigl[\bigl[1+\frac{4}{\delta_{0}^{2}C_{0}^{1/2}}\bigr(\frac{2xg\rho D^{2}}{A\eta_{a}^{2}}\bigl)^{1/2}\bigr]^{1/2}-1\Bigr]^{2}
\label{sn21}
\end{eqnarray}

In this formulation, required variables are mass, projection area, maximum dimension of ice particles and thermodynamical variables. Here we use several piecewise-constant mass-maximum dimension and projection area-maximum dimension relationships provided by Mitchell (1996). The terminal velocities of various ice particles are plotted in Fig.\ref{figsn2-12}. As shown in Fig.\ref{figsn2-11} there is less difference between hexagonal plates and stellar crystals with broad arms with the diameter less than a few hundred micrometers. Therefore we only consider hexagonal column and hexagonal plate as representatives of the category of ice.


\subsubsection{Adjustment factor of terminal velocity}
Beard (1980) suggested that calculation of the terminal velocity using the Best number could be simplified with use of an adjustment factor ($f_{vt}$) defined as,

\begin{eqnarray}
\nu_{t}=\nu_{t0}f_{vt}
\label{sn23}
\end{eqnarray}

where $v_{t0}$ is a reference terminal velocity. He demonstrated that $f_{vt}$ was not sensitive to the shape of hydrometeors. When electrical force is not considered in the cloud microphysics, formulas of $f_{vt}$ are as follows,

\begin{eqnarray}
f_{vt}&=&f_{vt0}\;\;(N_{Re_{0}}\leq0.2)\label{sn24}\\
f_{vt}&=&f_{vt\infty}\;\;(N_{Re_{0}}\geq1000)\label{sn25}\\
f_{vt}&=&f_{vt0}\nonumber\\
&+&(f_{vt\infty}-f_{vt0})(1.61+lnN_{R_{e}0})/8.52\;\;(N_{Re_{0}}<1000)\label{sn26}\\
f_{vt0}&\equiv&(\eta_{0}/\eta)\label{sn27}\\
f_{vt\infty}&\equiv&(\rho_{0}/\rho)^{0.5}\label{sn28}\\
N_{R_{e}0}&\equiv&\rho_{0}Dv_{t0}/\eta_{0}\label{sn29}
\end{eqnarray}

The upper limit of the Reynolds number ( $N_{R_{e}}$ = 1000 ) corresponds to a diameter of several milimeters and the lower limit of the Reynolds number ( $N_{R_{e}}$ = 0.2 ) corresponds to a diameter of tens of micrometers. Seifert and Beheng (2006) applied a further simplified adjustment factor based on eq.\ref{sn27} and eq.\ref{sn28} as follows,

\begin{eqnarray}
f_{vt,n}=(\rho_{0}/\rho)^{\gamma_{n}}, \;\;\;(n=c,r,i,s,g)
\label{sn30}
\end{eqnarray}

where $\gamma_{c}$ = 1.0 and $\gamma_{r}$ = $\gamma_{i}$ = $\gamma_{s}$ = $\gamma_{g}$ = 0.5 This simplification formula of the adjustment factor is intended to avoid the dependency on the Reynolds number. However, $\gamma_{n}$ = 0.5 is valid only for high Reynolds number particles whose diameters are more than several millimeters as shown in eq.\ref{sn21}. Therefore, the above formula always underestimates the terminal velocity of cirrus clouds. Another simplified formula for cirrus clouds was suggested by Heymsfield and Iaquinta (2000) as follows,

\begin{eqnarray}
f_{vt}=(p/p_{0})^{-0.178}(T/T_{0})^{-0.394}
\label{sn31}
\end{eqnarray}

where $T_{0}$ = 233 K and $p_{0}$ = 300 hPa. By using these adjustment factors, we can only consider the terminal velocity for the reference atmosphere. Adjustment factors used for each hydrometeor in this study are summarized in Table \ref{table_sn14-2-8}.

\begin{table}[h]
\begin{center}
\caption{Adjustment factor for the reference terminal velocity.}
\label{table_sn14-2-8}
\scalebox{0.75}{
\begin{tabular}{cccccc}
\hline
           & cloud     & rain    & Ice   & snow   & graupel   \\ \hline\hline
$f_{vt}$   & 1         & $(\rho_{0}/\rho)^{0.5}$ & $(p/p_{0})^{-0.178}(T/T_{0})^{-0.394}$ & $(p/p_{0})^{-0.178}(T/T_{0})^{-0.394}$ & $(p/p_{0})^{-0.178}(T/T_{0})^{-0.394}$ \\ \hline
\end{tabular}
}
\end{center}
\end{table}


\subsubsection{Weightend mean terminal velocity}
In gravitational sedimentation, the mean terminal velocity weighted by the k-th moments of DSD (${\bf \bar{v_{k,nq}}}$) is calculated straightforward as follows

\begin{eqnarray}
\bar{v_{k,nq}}=\int_{0}^{\infty}x^{k}f_{nq}(x)v_{t,nq}(x)dx
\label{sn32}
\end{eqnarray}

However, the formulas of the terminal velocities, eq.\ref{sn14} and eq.\ref{sn21} are too complicated to analytically integrate eq.\ref{sn32}. Seifert and Beheng (2006) and Seifert (2008) approximately used the large branch of eq.\ref{sn14} for rain droplets and simple power laws derived by observation for other hydrometeors. Here we made more accurate formulations to calculate the weighted terminal velocities.\\
As shown above, the dependency of the terminal velocity on the diameter varies among the aerodynamical regimes. In other words, the dependency varies among the range of diameter. Therefore, firstly we prepared two branches of the terminal velocities of hydrometeors except for cloud droplets so as to integrate the DSDs analytically. For cloud droplets, we use the same power law provided by Seifert and Beheng (2006) which is based on Stokes’ law. For the rain droplets, we directly use the formulation of eq.\ref{sn14} because we can integrate each branch analytically. In contrast, we need to derive two fitting curves for ice particles. The formulation of the terminal velocity of ice particles is described as a power law of the diameter made by the least-square method as follows,

\begin{eqnarray}
v_{t,js}&=&a_{v,js}x^{b_{v,js}},\;\;(js=i,s,g)\label{sn33}\\
(RMSE)_{k,js}&=&\sum_{id=1}^{id_max}\bigl(ln\bar{v_{k,js,true}}(\bar{D_{id}})-ln\bar{v_{k,js}}(\bar{D_{id}})\bigr)^{2}\label{sn34}\\
\frac{\partial(RMSE)_{k,js}}{\partial a_{v,js}}&=&0,\:\frac{\partial (RMSE)_{k,js}}{\partial b_{v,js}}=0\nonumber\\
\bar{v_{k,js}}(\bar{D_{id}})&=&\int_{0}^{\infty}a_{v,js}x^{b_{v,js}+k}f(x,\bar{D_{id}},L)dx/L\nonumber\\
&=&a_{v,js}\frac{\Gamma\bigl(\frac{v_{js}+b_{v,js}+k+1}{\mu_{js}}\bigr)}{\Gamma\bigl(\frac{v_{js}+k+1}{\mu_{js}}\bigr)}
\Bigl[\frac{\Gamma\bigl(\frac{v_{js}+1}{\mu_{js}}\bigr)}{\Gamma\bigl(\frac{v_{js}+2}{\mu_{js}}\bigr)}\Bigr]^{b_{v,js}}\bar{x_{id,js}^{b_{v,js}}}\label{sn35}\\
\bar{v_{k,js,true}}(\bar{D_{id}})&=&\sum_{i=1}^{imax}x^{k}v_{t,js,true}f_{logD}(lnD_{i},\bar{D_{id}},L)\Delta ln D/L\nonumber
\end{eqnarray}

where $D_{1}=10\mu m$, $D_{imax}=10mm$, $i_{max}=1000$, and L is arbitrary constant. The fitting ranges of the mean volume diameter in eq.\ref{sn34} are from 20 to 400 $\mu$m for the small branch and from 200 to 2000 $\mu m$ for the large branch. The derived parameters are summarized in Table \ref{table_sn14-2-9}.\\ 
Secondly the terminal velocity with a certain mean diameter is calculated by interpolating between the two branches in the logaritgmic scale of the diameter. Here we practically use the mean diameter weighted by the kth moments of DSD in the interpolation. The formulation of the weighted terminal velocities of the rain droplets and solid particles are as shown in the following,

\begin{eqnarray}
\bar{v_{k,nq}}&=&w_{k,nq}\bar{v_k,lrg,nq}+(1-w_{k,nq})\bar{v_{k,lrg,nq}},\;\;(nq=r,i,s,g)\label{sn36}\\
w_{k,r}&=&0.5(1+tanh(\pi ln(\bar{D_{k,r}}/D_{0,k,r})))\nonumber\\
w_{k,js}&=&max(0.0, \;min(1.0,0.5(1+ln(\bar{D_{k,js}}/D_{0,k,js}))))\;\;(js=i,s,g)\nonumber\\
\bar{D_{k,nq}}&=&\frac{\int_{0}^{\infty}D_{nq}(x)x^{k}f_{nq}(x)dx}{\int_{0}^{\infty}x^{k}f_{nq}(x)dx}\nonumber\\
              &=&\bar{D_{nq}}\frac{\Gamma\bigl(\frac{v_{nq}+b_{m,nq}+k+1}{\mu_{nq}}\bigr)}{\Gamma\bigl(\frac{v_{nq}+k+1}{\mu_{nq}}\bigr)}\Bigl[\frac{\Gamma\bigl(\frac{v_{nq}+1}{/mu_{nq}}\bigr)}{\Gamma\bigl(\frac{v_{nq}+2}{\mu_{nq}}\bigr)}\Bigr]^{b_{m,nq}}\label{sn37}\\
\bar{v_{k,sml,r}}&=&\frac{f_{vt,r}}{M_{r}^{k}}\int_{0}^{\infty}\bigl[a_{R_{s}}D(1-exp(-b_{R_{s}}D))\bigr]x^{k}N_{r}(D)dD\nonumber\\
&=&a_{R_{s}}\frac{(1+\mu_{D,r}+3k)}{\lambda_{D,r}}\nonumber\\
&\times&\Bigl[1-\bigl(1+\frac{b_{R_{s}}}{\lambda_{D,r}}\bigr)^{-2-\mu_{D,r}-3k}\Bigr]\bigl(\frac{\rho_{0}}{\rho}\bigr)^{1/2}\label{sn38}\\
\bar{v_{k,lrg,r}}&=&\frac{f_{vt,r}}{M_{r}^{k}}\int_{0}^{\infty}\bigl[a_{Rl}-b_{Rl}exp(-c_{Rl}D)\bigr]x^{k}N_{r}(D)dD\nonumber\\
&=&a_{Rl}-b_{Rl}\bigl(1+\frac{c_{Rl}}{\lambda_{D,r}}\bigr)^{-1-\mu_{D,r}-3k}\bigl(\frac{\rho_{0}}{\rho}\bigr)^{1/2}\label{sn39}\\
N_{r}(D)&=&N_{0,r}D^{-\mu_{D,r}}exp(-\lambda_{D,r}D)
\end{eqnarray}

where $D_{0,r}$ and $D_{0,js}$ are the branch points of the fitting curves (see Table \ref{table_sn14-2-10}). Here we apply the form of the modified gamma distribution for the diameter as a DSD of rain droplets. Derivation and correspondences of the coefficient $N_{0,r}$ the slope parameter $\lambda_{D}$,$r$ and shape parameter $\mu D$ appeared in the modified gamma distribution are described in Appendix B. Weighted terminl velocities of ice particles for two branches, and, are calculated by eq.\ref{sn35}. Fig.\ref{figsn2-13} shows the terminal velocity of rain droplets weighted by number and mass concentration. Our method gives better results than the results by the approximated method applied in Seifert and Beheng (2006) in the range within their upper and lower limit. Fig.\ref{figsn2-14} shows terminal velocities of ice particles weighted by the number and the mass concentration. 


\begin{table}[h]
\begin{center}
\caption{Coefficients and exponents of the relationship between the mass and the terminal velocity of each hydrometeor used in the gravitational sedimentation and other processes.}
\label{table_sn14-2-9}
\scalebox{0.5}{
\begin{tabular}{cccccc}
\hline
Hydrometeors & Sedimentation of mass & Sedimentation of mass & Sedimentation of number   & Sedimentation number & other process   \\ \hline\hline
             & Small                 & Large                 & Small                     & Larg                 &                 \\ \hline
Cloud        & $a_{v}=3.75\times10^{5},b_{v}=2/3$ & $a_{v}=3.75\times10^{5},b_{v}=2/3$ & $a_{v}=3.75\times10^{5},b_{v}=2/3$ & $a_{v}=3.75\times10^{5},b_{v}=2/3$ & $a_{v}=3.75\times10^{5},b_{v}=2/3$ \\  \hline
Rain         & \ref{sn14}            & \ref{sn14}            & \ref{sn14}                & \ref{sn14}           & \ref{sn14}      \\ \hline
Hexagonal plate & $a_{v}=5800,b_{v}=0.505$ & $a_{v}=167,b_{v}=0.325$ & $a_{v}=1.24\times10^{5},b_{v}0.549$ & $a_{v}=422,b_{v}=0.385$ & $a_{v}=5800,b_{v}=0.505$\\ \hline
Hexagonal columns & $a_{v}=2900,b_{v}=0.466$ & $a_{v}=32.2,b_{v}=0.224$ & $a_{v}=9698,b_{v}0.531$ & $a_{v}=64.2,b_{v}=0.274$ & $a_{v}=2900,b_{v}=0.466$\\ \hline
Aggregates of planar polycrystals & $a_{v}=1.52\times10^{5},b_{v}=0.528$ & $a_{v}=306.0,b_{v}=0.330$ & $a_{v}=2.93\times10^{5},b_{v}0.567$ & $a_{v}=818,b_{v}=0.394$ & $a_{v}=1.52\times10^{5}b_{v}=0.528$\\ \hline
Lump graupel & $a_{v}=1.55\times10^{5},b_{v}=0.535$ & $a_{v}=312.0,b_{v}=0.330$ & $a_{v}=2.76\times10^{5},b_{v}0.571$ & $a_{v}=698,b_{v}=0.387$ & $a_{v}=1.55\times10^{5}b_{v}=0.535$\\ \hline
\end{tabular}
}
\end{center}
\end{table}

\begin{table}[h]
\begin{center}
\caption{Branch points of the weighted terminal velocity.}
\label{table_sn14-2-10}
\scalebox{0.75}{
\begin{tabular}{cc}
\hline
Hydrometeors & Branch points of the weighted terminal velocity [m]   \\ \hline
Cloud        & Not used \\ \hline
Rain         & $D_{0,r}=7.45\times10^{-4}$ \\ \hline
Hexagonal plates & $D_{0,0,i}=262\times10^{-6}, D_{0,1,i}=399\times10^{-6}$ \\ \hline
Hexagonal columns& $D_{0,0,i}=240.5\times10^{-6}, D_{0,1,i}=330\times10^{-6}$ \\ \hline
Aggrgates of planar polycrystals & $D_{0,0,s}=270\times10^{-6}, D_{0,1,s}=270\times10^{-6}$ \\ \hline
Lump graupel & $D_{0,0,g}=269\times10^{-6}, D_{0,1,g}=376\times10^{-6}$ \\ \hline
\end{tabular}
}
\end{center}
\end{table}

\begin{figure}[]
\begin{center}
\includegraphics[scale=0.3]{./figure/D_vt_sn14.eps}
\end{center}
\caption{Dependency of terminal velocity of liquid water droplet on diameter. Marks are from Gunn and Kinzer (1948), red line is from Rogers et al. (1993) and blue line is calculated by Stokes’ law (eq.\ref{sn12}) under the condition T=293K, p=1000hPa.}
\label{figsn2-11}
\end{figure}

\begin{figure}[]
\begin{center}
\includegraphics[scale=0.3]{./figure/D_vt_sn14-ice.eps}
\end{center}
\caption{Dependency of terminal velocity of liquid water droplet in maximum dimension. Each color of solid line is corresponding to different ice particle type based on Mitchell (1996). Hexagonal columns is blue, hexagonal plates is green, stellar crystal with broad arms is red, Aggregates of planar polycrystals in cirrus clouds is purple and lump graupel is light blue.}
\label{figsn2-12}
\end{figure}

\begin{figure}[]
\begin{center}
\includegraphics[scale=0.4]{./figure/D_vt_sn14-1.eps}
\end{center}
\caption{Dependencies of number weighted terminal velocity ($v_{tN}$) (left) and mass weighted terminal velocity ($v_{tL}$) (right) of rain droplets on mean volume diameter ($D_{m}$). Abscissa is the mean volume diameter and vertical axis is the terminal velocity. Dots show exactly integrated value and solid lines show approximated value by this study (red, green and blue) and Seifert and Beheng (2006) (purple). Red and purple ones are calculated with $\mu D$ = 0, green ones are calculated with $\mu D$ = 1 and blue ones are calculated with $\mu D$ = 31.}
\label{figsn2-13}
\end{figure}

\begin{figure}[]
\begin{center}
\includegraphics[scale=0.4]{./figure/D_vt_sn14-ice-1.eps}
\end{center}
\caption{Dependencies of number weighted terminal velocity ($v_{tN}$) (left) and mass weighted terminal velocity ($v_{tL}$) (right) of ice particles on mean volume diameter ($D_{m}$). Abscissa is the mean volume diameter and vertical axis is the terminal velocity. Dots show the exact value calculated by Mitchell (1996) and solid lines show the fitting curves. Red, green, blue and purple denote lump graupels, assemblages of planar polycrystals, hexagonal columns and hexagonal plates respectively.}
\label{figsn2-14}
\end{figure}

\subsubsection{Detailed description of cloud microphysics}
Cloud microphysics is mainly categorized into two physics. One is phase change among the gas, liquid, and solid phases. Another is the collection process among all the particles. In addition, all the hydrometeors are vertically transported by gravitational sedimentation. Phase change depends on the thermodynamics of environment air and affects thermodynamics itself through latent heat release. In contrast, collection is an internal growth process with less interaction with the atmosphere. Since the growth speed of the collection process is much faster than that of phase change, the role of the collection process is a key to determine the lifetime of cloud (e.g. lifetime effect). Finally, gravitational sedimentation determines the removal rate of cloud from the atmosphere. Directly it removes cloud by transportation, and indirectly by the collection process via collision volume (swept volume).\\
The cloud microphysics scheme developed in this study basically follows Seifert and Beheng (2006). Their two-moment bulk cloud microphysics scheme is remarkable in improvement of the collection process by using a bin cloud microphysics scheme. After their works, we modify the cloud nucleation process (Twomey 1959; and Lohmann 2002), the condensation process (Morrison et al. 2005), and the formulation of the terminal velocities (Mitchell, 1996) with expectation of the application to global cloud resolving simulations. We describe production and reduction terms of the mass concentration and the number concentration in the following sub-sections. 

\subsubsection{Phase change}
\subsubsection{Condensation/evaporation}
Theoretical formulation of condensation or evaporation is basically derived by balance equation of vapor and thermal diffusion above the surface of a single particle (Rogers and Yau, 1989; Pruppacher and Klett, 1997). The growth rate of liquid droplet mass $x_{i}$l is described as follows,

\begin{eqnarray}
\frac{dx_{jl}}{d}&=&2\pi D(x_{jl})G_{lv}(T,p)F_{vf}(x_(jl))S_{w},\; (jl=c,r)\label{sn66}\\
G_{lv}&=&\Bigl[\frac{R_{v}T}{p_{sw}(T)D_{v}}+\frac{L_{v0}}{K_{T}T}\bigl(\frac{L_{v0}}{R_{v}}{T}-1\bigr)\Bigr]^{-1}\label{sn67}\\
F_{vf}(x_{r})&=&a_{vf,r}+b_{vf,r}N_{S_{c}}^{1/3}N_{R_{e}}^{1/2}\label{sn68}
\end{eqnarray}

Here $G_{lv}$ is a coefficient related with vapor and thermal diffusion, $D_{v}$ is diffusivity of water vapor and $K_{T}$ is thermal conductivity, and $F_{vf}$ is the so-called ventilation coefficient. This is a correction factor for assumption that the water vapor field surrounding each droplet is spherically symmetrical. Formulation of Fvf was experimentally determined by Pruppacher and Klett (1997) and it depends on Schmidt number ($N_{S_{c}}$) and Reynolds number ($N_{R_{e}}$). This formulation for single droplets is transformed into that for moments following to Seifert and Beheng (2006). With assumption of DSD as a generalized Gamma distribution and neglecting the change of DSD caused by other process in a time step, we can derive the growth rate of moments,

\begin{eqnarray}
\frac{\partial M_{jl}^{k}}{\partial t}\Bigr|_{cnd,evp}\cong \int_{0}^{\infty}f_{jl}(x)x^{k-1}\frac{\partial x}{\partial t}\Bigr|_{cnd,evp}dx\label{sn69}
\end{eqnarray}

we can consider eq.\ref{sn69} from a different view point as follows,

\begin{eqnarray}
\frac{\partial M_{jl}^{k}}{\partial t}\Bigr|_{cnd,evp}&\cong& \int_{0}^{\infty}f_{jl}(x)x^{k}\Bigl[\frac{1}{x}\frac{\partial x}{\partial t}\Bigr|_{cnd,evp}\Bigr]dx\label{sn69}\nonumber\\
&=&\int_{0}^{\infty}\frac{f_{jl}(x)x^{k}}{\tau}dx,\;\tau\equiv\frac{x}{\frac{\partial x}{\partial t}}\bigr|_{cnd,evp}\label{sn70}
\end{eqnarray}

Here, we mention that the theoretical treatment of condensation or evaporation change droplet mass only. Then, we diagnose the growth rates of other moments by the change ratio of droplet mass with time scale $\tau$. Thus, we can derive the growth equation for arbitrary moments,

\begin{eqnarray}
\frac{\partial M_{jl}^{k}}{\partial t}\Bigr|_{cnd,evp}&=&2\pi G_{lv}S_{w}\int_{0}^{\infty}D_{jl}(x)F_{vf,jl}(x)f_{jl}(x)x^{k-1}dx\nonumber\\
&=&2\pi G_{lv}S_{w}N_{jl}D_{jl}(\bar{x}_{jl})\bar{F}_{vf,k,jl}(\bar{x}_{jl})\bar{x}_{jl}^{k-1}\label{sn71}
\end{eqnarray}

where $\bar{F}_{vf,k,il}$ is an averaged ventilation factor for the k-th moment of DSD. This formulation seems to be valid unless reduction of number concentration occurs. Because reduction of number concentration occurs only in the case of the smallest droplet being completely dissipated by evaporation, the formulation by change ratio is not suitable for complete dissipation. Therefore this formulation is incomplete to derive the reduction tendency of number concentration by evaporation (condensation never changes number concentration). Temporarily, we assumed that the number concentration of cloud droplets never reduces unless their mean mass of cloud ($\bar{x}_{c}$) falls below the lower limit $\bar{x}_{c,min}$. The treatment of rain droplets is discussed in the following section.


\subsubsection{Evaporation of rain droplets}
Only in the case of rain droplets, Seifert (2008) attempted to overcome the incompleteness for the reduction of number concentration in evaporation. He reformulated eq.\ref{sn71} as follows,

\begin{eqnarray}
\frac{\partial N_{r}}{\partial t}\Bigr|_{evp}\equiv \gamma_{evp}\frac{N_{r}}{L_{r}}\frac{\partial L_{r}}{\partial t}=\frac{\gamma_{evp}}{\bar{x}}2\pi G_{lv}S_{w}N_{r}D_{r}(\bar{x}_{r})\bar{F}_{vf,l}(\bar{x}_{r})\label{sn72}
\end{eqnarray}

Here evaporation parameter $\gamma_{evp}$ means the evaporation efficiency of number concentration towards to mean mass $\bar{x}_{r}$. According to Seifert (2008), $\gamma_{evp}$ and $\mu_{m,r}$ are parameterized as follows,

\begin{eqnarray}
\gamma_{evp}&=&\frac{D_{eq}}{D(\bar{x}_{r})}exp(-0.2\mu_{m,r})\label{sn73}\\
\mu_{m,r}&=&
\left\{
\begin{array}{l}
6tauh[{c_{evp,1}(D(\bar{x}_{r})-D_{eq})}^{2}]+1\;\;(D(\bar{x}_{r})\leq D_{eq}) \\
30tauh[{c_{evp,2}(D(\bar{x}_{r})-D_{eq})}^{2}]+1\;\;(D(\bar{x}_{r})\leq D_{eq})
\label{sn74}
\end{array}
\right.
\end{eqnarray}

where $D_{eq} = 1.1 \times 10^{-3} m$ is the equilibrium diameter in breakup-coalescence processes and the $c_{evp,1}$ and $c_{evp,2}$ are set to 4000 $m^{-1}$ and 1000 $m^{-1}$, respectively. In this study, we apply eq.\ref{sn71} for mass and eq.\ref{sn72} with $\gamma_{evp}$ = 1 for number concentration as a default setting (refer to SB06-run).

\subsubsection{Deposition/sublimation for solid water}
Theoretical formulation of deposition or sublimation is the same as that of condensation or evaporation except for the definition of surface area. The shape of ice particles is not spherical and varies widely as is shown in section 2.1.2. Therefore, vapor and thermal transfer over the particle surface is expressed by the analogy between the diffusion equation and equations in electrostatics (Pruppacher and Klett, 1997). Replacing diameter $D_{js}$ by capacitance $C_{js}\equiv D{js}/c_{js}$, we can derive the growth equation of a single particle as follows,

\begin{eqnarray}
\frac{dx_{js}}{dt}\Bigr|_{dep,sbl}&=&4\pi C_{js}G_{sv}(T,p)F_{vf}(x_{js})S_{i},\;\;(js=i,s,g)\label{sn75}\\
G_{sv}&=&\Bigl[\frac{R_{v}T}{p_{si}(T)D_{v}}+\frac{L_{s,0}}{K_{T}T}\bigl(\frac{L_{s0}}{R_{v}T}-1\bigr)\Bigr]^{-1}\label{sn76}
\end{eqnarray}

Here $C_{js}$ = $D_{js}/2$ for sphere, $C_{js} = D_{js}/\pi$ for circular plate, and capacitances of other typical shapes such as oblate spheroid crystals and columnar crystals are expressed by,

\begin{eqnarray}
C_{js}&=&\frac{D_{js}\varepsilon}{2sin^{-1}\varepsilon},\;\;\varepsilon\equiv\bigl(1-\frac{b^{2}}{a^{2}}\bigr), \;(for\;spheroid)\label{sn77}\\
C_{js}&=&\frac{A}{ln[(a+A)/b]},\;A\equiv=(a^{2}-b^{2})^{1/2},\;\;(for\;columnar)
\end{eqnarray}

where a is semi-major axis and b is semi-minor axis. For simplification, cloud, rain, snow and graupel are assumed as sphere and hexagonal plate ice is assumed as circular plate here. In the same manner as condensation (evaporation), we can derive the growth equation of arbitrary moments as follows,

\begin{eqnarray}
\frac{\partial M_{js}^{k}}{\partial t}\Bigr|_{dep,sbl}=\frac{4\pi}{c_{js}}G_{sv}S_{i}N_{js}D_{js}(\bar{x}_{js})\bar{F}_{vf,k}(\bar{x}_{js})\bar{x}_{js}^{k-1}\label{sn79}
\end{eqnarray}

Discussion concerning the reduction term of number concentration is the same as that for rain droplets. Therefore, we applied eq.\ref{sn79} for mass concentration of solid particles. For snow and graupel, the reduction rate of number concentration is as follows,

\begin{eqnarray}
\frac{\partial N_{js}^{k}}{\partial t}\Bigr|_{sbl}&\equiv&\frac{N_{js}}{L_{js}}\frac{\partial L_{js}}{\partial t}\Bigr|_{sbl}\nonumber\\
&=&\frac{1}{\bar{x}_{js}}\frac{4\pi}{c_{js}}G_{sv}S_{i}N_{js}D_{js}(\bar{x}_{js})\bar{F}_{vf,1}(\bar{x}_{js})(js=s,g)\label{sn80}
\end{eqnarray}

This formulation corresponds to $\gamma_{evp} = 1$ in the reduction term for rain droplets. That means sublimation occurs so as not to change the mean mass of DSD ($\bar{x}_{js}$). Number concentration of ice never reduces in sublimation unless the mean mass of ice ($\bar{x}_{i}$) falls below the lower limit. The formulations of the reduction rate for the number concentration of ice particles are somewhat temporary and will be improved by the insights drawn from the results of microphysics bin schemes and observations in future work.

\subsubsection{Accurate integration method to solve condensation/evaporation and deposition/sublimation}
The condensation/evaporation process for cloud droplets usually requires a smaller time step than rain droplets or other particles because of its timescale. When we apply the time integration with the first ordered Euler method, the accuracy of the condensation/evaporation and the deposition/sublimation processes are worse unless we resolve their timescale. We estimate the timescale with the exact thermodynamic definition in NICAM initially and then formulate an accurate method to apply the condensation process and the evaporation process for cloud droplets similar to Khvorostyanov and Sassen (1998) and Morrison et al., (2005). Since the supersaturated condition is achieved by updraft of air mass, we consider a Lagrangian parcel model with constant updraft velocity and no mixing with external air mass. Basic formulation is based on the Lagrangian change rate of supersaturation ($\delta_{sw} = q_{v} - q_{sw}$) as follows,

\begin{eqnarray}
\frac{d \delta_{sw}}{dt}=\Bigl(\frac{dq_{v}}{dt}-\frac{dq_{sw}}{dt}\Bigr)\label{sn81}
\end{eqnarray}

Hereafter we consider the tendency of specific humidity and saturation specific humidity by dynamics, cloud microphysics and radiative heating.\\
At first, assuming an adiabatically ascending/descending parcel with no phase change ($q_{v}/dt = 0$), eq.(\ref{sn81}) becomes

\begin{eqnarray}
\frac{d\delta_{sw}}{dt}=-\bigl(\frac{\partial q_{sw}}{\partial T}\bigr)_{p}\frac{dT}{dt}-\bigl(\frac{\partial q_{sw}}{\partial p}\bigr)_{T}\frac{dp}{dt}\label{sn82}
\end{eqnarray}

Here the tendencies of temperature and pressure are described as follows,

\begin{eqnarray}
\frac{dT}{dt}=\frac{1}{\rho\bar{c}_{p}}\frac{dp}{dt},\;\;\frac{dp}{dt}\approx-\rho g w\label{sn83}
\end{eqnarray}

where $\bar{c}_{p}\equiv q_{d}c_{pd}+q_{v}c_{pv}+q_{liq}c_{l}+q_{sol}c_{i}$ is the mean specific heat at constant pressure. We can derive the dynamic component of the tendency of $\delta_{sw}$ by substituting eq. \ref{sn83} into eq.\ref{sn82} as follows

\begin{eqnarray}
\frac{d\delta_{sw}}{dt}\Bigr|_{DYN}=wg\Bigl(\frac{1}{\bar{c}_{p}}\bigl(\frac{\partial q_{sw}}{\partial T}\bigr)_{p}+\rho\bigl(\frac{\partial q_{sw}}{\partial p}\bigr)_{T}\Bigr)\label{sn84}
\end{eqnarray}

Assuming air parcel with only cooling/heating by latent heat release, eq. \ref{sn81} becomes

\begin{eqnarray}
\frac{d\delta_{sw}}{dt}=\frac{dq_{v}}{dt}-\bigl(\frac{\partial q_{sw}}{\partial T}\bigr)\frac{dT}{dt}\label{sn85}
\end{eqnarray}

The tendency of temperature is caused by latent heat release with condensation/evaporation and deposition/sublimation %eq.\ref{sn58}; eq.\ref{sn59} %; and Table \ref{table_sn14-2-11}

\begin{eqnarray}
\frac{dT}{dt}&=&\frac{L_{v,00}+(c_{vv}-c_{l})T}{\bar{c}_{va}}\frac{dq_{liq}}{dt}+\frac{L_{v,00}+L_{f,00}+(c_{v}-c_{i})T}{\bar{c}_{va}}\frac{dq_{sol}}{dt}\nonumber\\
&=&\frac{L_{v,00}+(c_{vv}-c_{l}) T}{\bar{c}_{va}} \sum^{jl_{max}}_{jl=1}\frac{dq_{jl}}{dt}\Bigr|_{cnd,evp}\nonumber\\
&+&\frac{L_{v,00}+L_{f,00}+(c_{vv}-c_{i})T}{\bar{c}_{va}}\sum^{js_{max}}_{js=1}\frac{dq_{js}}{dt}\Bigr|_{dep,sbl}\label{sn86}
\end{eqnarray}

The tendency of specific humidity is caused by condensation/evaporation and deposition/sublimation,

\begin{eqnarray}
\frac{dq_{v}}{dt}=-\sum_{jl=1}^{jl_{max}}\frac{dq_{jl}}{dt}\Bigl|_{cnd,evp}-\sum_{js=1}^{js_{max}}\frac{dq_{js}}{dt}\Bigr|_{dep,sbl}\label{sn87}
\end{eqnarray}

Then, we can derive the cloud microphysics component of the tendency of $\delta_{sw}$ by substituting eq.\ref{sn86} and eq.\ref{sn87} into eq.\ref{sn85},

\begin{eqnarray}
\frac{d\delta_{sw}}{dt}\Bigr|_{MP}&=&-\Bigl(1+\frac{L_{v,00}+(c_{vv}-c_{l})T}{\bar{c}_{v}}\bigl(\frac{\partial q_{sw}}{\partial T}\bigr)_{p}\Bigr)\sum_{jl=1}^{jl_{max}}\partial{dq_{jl}}{dt}\Bigr|_{cnd,evp}\nonumber\\
&-&\Bigl(1+\frac{L_{v,00}+L_{f,00}+(c_{vv}-c_{i})T}{\bar{c}_{v}}\bigl(\frac{\partial q_{sw}}{\partial T}\bigr)_{p}\Bigr)\sum^{js_{max}}_{js=1}\frac{dq_{js}}{dt}\Bigr|_{dep,sbl}\label{sn88}
\end{eqnarray}

By replacing the source term of the mixing ratio of hydrometeors in eq.\ref{sn88} with eq.\ref{sn71} and eq.\ref{sn79}

\begin{eqnarray}
\frac{dq_{jl}}{dt}\Bigr|_{cnd,evp}&=&\frac{\delta_{sw}}{\tau_{cnd,jl}},\;or\nonumber\\
\frac{dq_{jl}}{dt}\Bigr|_{cnd,evp}&=&\frac{\delta_{si}}{\tau_{cnd,jl}}-\frac{q_{sw}-q_{si}}{\tau_{cnd,jl}},\;\;(jl=c,r)\label{89}\\
\frac{dq_{js}}{dt}\Bigr|_{de,sbl}&=&\frac{\delta_{si}}{\tau_{dep,js}},\;or\nonumber\\
\frac{dq_{js}}{dt}\Bigr|_{dep,sbl}&=&\frac{\delta_{sw}}{\tau_{dep,js}}+\frac{q_{sw}-q_{si}}{\tau_{dep,js}},\;\;(js=i,s,g)\label{90}\\
\tau_{cnd,jl} &\equiv& \Bigl(\frac{1}{\rho q_{sw}} 2\pi G_{lv}D_{jl}(\bar{x}_{jl})N_{jl}\bar{F}_{vf,1}\Bigr)^{-1}\label{sn91}\\
\tau_{dep,js} &\equiv& \Bigl(\frac{1}{\rho q_{si}}\frac{4\pi}{c_{js}}G_{sv}D_{js}(\bar{x}_{js})N_{js}\bar{F}_{vf,1}\Bigr)^{-1}\label{sn92}
\end{eqnarray}


We can rewrite eq.\ref{sn88} as a function of super saturation itself,
\begin{eqnarray}
\frac{\partial \delta_{sw}}{\partial t}\Bigr|_{MP}=&-&\bigl(\frac{a_{liq,liq}}{\tau_{cnd,c}}+\frac{a_{liq,liq}}{\tau_{cnd,r}}+\frac{a_{sol,liq}}{\tau_{dep}}+\frac{a_{sol,liq}}{\tau_{dep,s}}+\frac{a_{sol,liq}}{\tau_{dep,g}}\bigr)\delta_{sw}\nonumber\\
&-&\bigl(\frac{1}{\tau_{dep,i}}+\frac{1}{\tau_{dep,s}}+\frac{1}{\tau_{dep,g}}\bigr)(q_{sw}-q_{si})\label{sn93}\\
a_{liq,liq}&\equiv& 1+\frac{L_{v00}+(c_{vv}-c_{l})T}{\bar{c}_{v}}\bigl(\frac{\partial q_{sw}}{\partial T}\bigr)_{p}\label{94}\\
a_{sol,liq}&\equiv& 1+\frac{L_{v00}+L_{f00}+(c_{vv}-c_{i})T}{\bar{c}_{v}}\bigl(\frac{\partial q_{sw}}{\partial T}\bigr)_{p}\label{95}
\end{eqnarray}

Here, we can find that $\tau_{cnd,jl}$ and $\tau_{dep,js}$ in eq.\ref{sn93} are considered as the characteristic time scale to relax the super saturation condition by the condensation/evaporation and deposition/sublimation processes. The timescale of each hydrometeor is modified by coefficient $a_{liq,liq}$ or$ a_{sol,liq}$, which means the effect of latent heat release. The second term on the right hand side in eq.\ref{sn93} means the transfer of vapor from liquid droplets to solid particles. The Bergeron-Findeisen process is implicitly formulated by the difference of saturation vapor pressure between liquid and solid.\\
Finally assuming an air parcel with radiative heating (cooling), eq.\ref{sn81} becomes

\begin{eqnarray}
\frac{d\delta_{sw}}{dt}\Bigr|_{RAD}=-\bigl(\frac{\partial q_{sw}}{\partial T}\bigr)_{\rho}\bigl(\frac{dT}{dt}\bigr)_{RAD}\label{sn96}
\end{eqnarray}

All the components in the Lagrangian ascending/descending parcel model are described by eq.\ref{sn84}, eq.\ref{sn93} and eq.\ref{sn96},

\begin{eqnarray}
\frac{d\delta_{sw}}{dt}&=&A_{cnd}-\frac{\delta_{sw}}{\tau_{cnd}}\label{sn97}\\
A_{cnd}&\equiv&\frac{d\delta_{sw}}{dt}\Bigr|_{DYN}+\frac{d\delta_{sw}}{dt}\Bigr|_{RAD}\nonumber\\
&-&\bigl(\frac{1}{\tau_{dep,i}}+\frac{1}{\tau_{dep,s}}+\frac{1}{\tau_{dep,g}}\bigr)(q_{sw}-q_{si})\label{sn98}\\
\tau_{cnd}&\equiv&\bigl(\frac{a_{liq,liq}}{\tau_{cnd,c}}+\frac{a_{liq,liq}}{\tau_{cnd,r}}+\frac{a_{sol,liq}}{\tau_{dep,i}}+\frac{a_{sol,liq}}{\tau_{dep,s}}+\frac{a_{sol,liq}}{\tau_{dep,g}}\bigr)^{-1}\label{sn99}
\end{eqnarray}

Here, we can see that $A_{cnd}$ is a production term of super saturation and τcnd is a characteristic timescale of all the phase changes. From their formulation (eq.\ref{sn91} and eq.\ref{sn92}), we can find that the timescale of each hydrometeor is in inverse proportion to its number concentration. The timescales under various conditions are shown in Fig.\ref{figsn2-19}.\\
Assuming that time variance of the production term and the timescale in a simulation time step don’t vary much within a model timestep, we can analytically solve eq.\ref{sn97},

\begin{eqnarray}
\delta_{sw}(t)=A_{cnd}\tau_{cnd}+(\delta_{sw}(t_{0})-A_{cnd}\tau_{cnd})exp\bigl(-\frac{t}{\tau_{cnd}}\bigr)\label{sn100}
\end{eqnarray}

where $t = t_{0} + \Delta t$ and $t_{0} = 0$. Then, the condensation (evaporation) rate of cloud and rain are reformulated by substituting eq.\ref{sn100} into eq.\ref{sn71} and integrating them,

\begin{eqnarray}
\frac{\Delta L_{jl}}{\Delta t}\Bigr|_{cnd,evp}&=&\rho A_{cnd}\frac{\tau_{cnd}}{\tau_{cnd,jl}}\nonumber\\
&-&\rho\frac{(\delta_{sw}(t_{0})-A_{cnd}\tau_{cnd})}{\Delta t}\frac{\tau_{cnd}}{\tau_{cnd,jl}}\Bigl[exp\bigl(-\frac{\Delta t}{\tau_{cnd}}\bigr)-1\Bigr]\label{sn101}
\end{eqnarray}

This semi-analytical formulation takes time variability of super saturation into condensation (evaporation) growth. Therefore, it is better than direct time integration with a first order Euler method.\\
In the same manner, we can also derive the semi-analytical formulation for deposition (sublimation) with super saturation for solid water ($\delta_{si}$),

\begin{eqnarray}
\delta_{si}(t)&=&A_{dep}\tau_{dep}+(\delta_{si}(t_{0})-A_{dep}\tau_{dep})exp\bigl(-\frac{t}{\tau_{dep}}\bigr)\label{sn103}\\
\frac{\Delta L_{js}}{\Delta t}\Bigr|_{dep,sbl}&=&\rho A_{dep}\frac{\tau_{dep}}{\tau_{dep,js}}\nonumber\\
&-&\rho\frac{(\delta_{si}(t_{0})-A_{dep}\tau_{dep})}{\Delta t}\frac{\tau_{dep}}{\tau_{dep,js}}\Bigl[exp\bigl(-\frac{\Delta t}{\tau_{dep}}\bigr)-1\Bigr]\label{sn104}
\end{eqnarray}

where

\begin{eqnarray}
A_{dep}&\equiv&\frac{d\delta_{si}}{dt}\Bigr|_{DYN}+\frac{d\delta_{si}}{dt}\Bigr|_{RAD}\nonumber\\
&+&\bigl(\frac{1}{\tau_{cnd,c}}+\frac{1}{\tau_{cnd,r}}\bigr)(q_{sw}-q_{si})\label{sn105}\\
\tau_{dep}&\equiv&\bigl(\frac{a_{liq,sol}}{\tau_{cnd,c}}+\frac{a_{liq,sol}}{\tau_{cnd,r}}+\frac{a_{sol,sol}}{\tau_{dep,i}}+\frac{a_{sol,sol}}{\tau_{dep,s}}+\frac{a_{sol,sol}}{\tau_{dep,g}}\bigr)^{-1}\label{sn106}\\
a_{liq,sol}&\equiv&1+\frac{L_{v00}+(c_{vv}-c_{l})T}{\bar{c}_{v}}\bigl(\frac{\partial q_{si}}{\partial T}\bigr)_{p}\nonumber\\
a_{sol,sol}&\equiv&1+\frac{L_{v00}+L_{f00}+(c_{vv}-c_{i})T}{\bar{c}_{v}}\bigl(\frac{\partial q_{si}}{\partial T}\bigr)_{p}\nonumber\\
\frac{d\delta_{si}}{dt}\Bigr|_{DYN}&=&wg\Bigl(\frac{1}{\bar{c}_{p}}\bigl(\frac{\partial q_{si}}{\partial T}\bigr)_{p}+\rho\bigl(\frac{\partial q_{si}}{\partial p}\bigr)_{T}\Bigr)\nonumber\\
\frac{d\delta_{si}}{dt}\Bigl|_{RAD}&=&-\bigl(\frac{\partial q_{si}}{\partial T}\bigr)_{\rho}\bigl(\frac{dT}{dt}\bigr)_{RAD}\nonumber
\end{eqnarray}

Finally we applied eq.\ref{sn101} and eq.\ref{sn104} for the prediction of mass concentration and eq.\ref{sn72} and eq.\ref{sn80} for the prediction of number concentrations of rain, snow and graupel. Number concentrations of cloud and ice are assumed not to change by evaporation and sublimation.


\subsubsection{Nucleation of cloud droplets}
Seifert and Beheng (2006) applied traditional empirical formulation as an aerosol activation spectrum as follows,

\begin{eqnarray}
N_{c}(S_{w,100})=C_{ccn}S_{w,100}^{\kappa_{ccn}}\label{sn107}
\end{eqnarray}

where super saturation ratio $S_{w,100}$ is in ％. They use $C_{ccn} = 1.26 \times 10^{9} m^{-3}$ and $\kappa_{ccn} = 0.308$ in continental conditions and $C_{ccn} = 1.0 \times 10^{8} m^{-3}$ and $\kappa_{ccn} = 0.462$ in maritime conditions. Further, Seifert and Beheng (2006) transformed eq.\ref{sn107} into a tendency formulation by time differentiation of the activation spectrum,

\begin{eqnarray}
\frac{\partial N_{c}}{\partial t}&=&
\left\{
\begin{array}{l}
C_{ccn}\kappa_{ccn}S_{w,100}^{\kappa_{ccn}-1}\frac{\partial S_{w,100}}{\partial z}w\nonumber\\
(S_{w,100}>0,\;w\frac{\partial S_{w,100}}{\partial z}>0,\;and\;S_{w,100}<1.1) \nonumber\\
0,\;\;(else) 
\end{array}
\right.\\
\label{sn108}
\frac{\partial L_{c}}{\partial t}\Bigr|_{nuc}&=&x_{c,nuc}\frac{\partial N_{c}}{\partial t}\Bigr|_{nuc}\label{sn109}
\end{eqnarray}

where $x_{c,nuc} = 10^{-12} kg$ is an arbitrary mass of nucleated droplets. Because the aerosol activity spectrum is a function of supersaturation and unbounded by the total aerosol number concentration, we chose an upper limit of activated aerosols as $1.5 \times C_{ccn}$, as similarly chosen by SB06: The maximum acticated aerosol number concentration is 1.5 times of the activated aerosol number concentration at ssw = 1 $^{o}/_{o}$. Here, we should mention that this formulation depends on the grid value of super saturation ratio, vertical velocity and vertical derivation of the super saturation ratio. Since super saturation significantly varies in tens of meters above cloud base (see Fig.\ref{figsn2-21}), accurate prediction of super saturation and its vertical derivation is quite difficult. In this study, we applied a traditional nucleation scheme (Twomey, 1959; Rogers and Yau, 1989) following Morrison et al. (2005),

\begin{eqnarray}
N_{c,nuc}(w_{eff})&=&0.88C_{ccn}^{2/(\kappa_{ccn}+2)}(0.07w_{eff}^{3/2})^{\kappa_{ccn}/(\kappa_{ccn}+2)}\label{sn110}\\
w_{eff}&\equiv&w+w_{TB}-\frac{\bar{c}_{p}}{g}\bigl(\frac{dT}{dt}\bigr)_{RAD}\label{sn111}
\end{eqnarray}

where $w_{eff}$ is effective vertical velocity for nucleation and $w_{TB}$ is the sub-grid variability of terminal velocity. This is an analytical formulation of maximum number concentration around the cloud base for the Twomey equation with aerosol activated spectrum by eq.\ref{sn107} (see Fig.\ref{figsn2-18}). By using this scheme we do not have to resolve the vertical variability of super saturation around the cloud base. Furthermore, applying sub-grid turbulence effects on vertical velocity reduces under estimation of nucleated cloud number concentration caused by low horizontal resolution (Ghan, et al., 1997; Lohmann, 2002; Morrison and Pinto, 2005). In this study, implementation of the sub-grid turbulence effect follows Lohmann (2002),

\begin{eqnarray}
w_{TB}&=&c_{TB}\bigl(\frac{2}{3}TKE\bigr)^{1/2}\label{sn112}\\
\bar{N}_{c,nucl}&=&0.1\times N_{c,nuc}(w_{eff})^{1.27}\label{sn113}
\end{eqnarray}

where $c_{TB} = 1$ is used in this study, $\bar{N}_{c,nuc}$ $cm^{-3}$ is a grid averaged nucleated cloud number concentration and $N_{c,nuc}(w_{eff}) cm^{-3}$ is maximum cloud number concentration in turbulent air. By substituting eq.\ref{sn110}, eq.\ref{sn111} and eq.\ref{sn112} into eq.\ref{sn113}, the tendency of cloud number concentration is calculated by,

\begin{eqnarray}
\frac{\partial N_{c}}{\partial t}\Bigr|_{nucl}&=&
\left\{
\begin{array}{l}
\frac{N_{c,nu}(w_{eff})-N_{c}}{\Delta t},\;\;(S_{w}>0,\;\bar{N}_{c,nuc}>N_{c}\;and\;at\;cloud\;base) \\
0,\;\;(else) \\
\label{sn114}
\end{array}
\right.\\
\frac{\partial L_{c}}{\partial t}\Bigr|_{nuc}&=&min\Bigl(x_{c,min}\frac{\partial N_{c}}{\partial t}\bigr|_{nuc},\frac{\delta_{sw}}{\Delta t}\Bigr)\label{sn115}
\end{eqnarray}

Since nucleation is usually limited around the cloud base within several tens of meters (see Fig.\ref{figsn2-21}), we define cloud base layer ($k_{cbase}$) where the nucleation scheme works as follows,

\begin{eqnarray}
1.5 \times C_{ccn} > \bar{N}_{c,nu}(k_{cbase})>0,\;\;and\;\;\bar{N}_{c,nu}(k_{cbase}-1) < 10^{6}\label{sn116}
\end{eqnarray}

In addition, we prepare the option (NO-TB) to switch off the effect of turbulence by substituting eq.\ref{sn110}, eq.\ref{sn111} with $w_{TB} = 0$ into eq.\ref{sn114}. There remain some problems to be solved in future,\\
1.Definition of cloud base is empirical and arbitrary\\
2.Implementation of sub-grid scale is empirical and $c_{TB}$ is a kind of tuning parameter. In particular, the TKE approach only considers isotropic eddies. Sub-grid should be expressed as sub-grid cloud dynamics.\\
3.Formulation of eq.\ref{sn113} does not converge with the NO-TB option when TKE = 0.\\
We need to investigate the above problems by using a large eddy simulation (LES) cloud model.

\subsubsection{Nucleation of cloud ice}
This study employed two simple ice nucleation schemes, which don’t require the properties of ice nuclei. One is the depositional and condensational freezing nucleation scheme parameterized by Meyers et al. (1992),

\begin{eqnarray}
N_{IN}=10^{3}exp(-0.639+12.96S_{sol})\nonumber
\end{eqnarray}

where $N_{IN}$ is nucleated ice nuclei, and $S_{sol}$ is supersaturation for solid water. While this scheme is widely used in CRMs (e.g., Walko et al. 1995; Khain et al., 2000; Seifert and Beheng, 2006), this scheme could not be acceptable for conditions at temperature below -20 degC or supersaturation over 0.25 where observational data were not available in their study. For simulating cirrus clouds around the tropopause, application of this scheme to CRMs may cause significant error. Phillips et al. (2007) proposed an alternative scheme to modify Meyers’s scheme by fitting to observational data at temperature between -30 degC and -80 degC taken by Demott et al. (2003),

\begin{eqnarray}
N_{IN}=10^{3}exp[0.3\times12.96(S_{i}-0.1)]\label{sn117}
\end{eqnarray}

In this study, the nucleation rate is formulated by the newly nucleated ice nuclei with the tendency of supersaturation in the same manner as Murakami (1990),

\begin{eqnarray}
\frac{\Delta N_{i}}{\Delta t}&=&
\left\{
\begin{array}{l}
\frac{\partial N_{IN}}{\partial S_{sol}}\frac{\partial S_{sol}}{\partial t},\;\;(S_{sol}>0\;and\;\frac{\partial S_{sol}}{\partial t}>0) \\
0,\;\;(else) \\
\end{array}
\right.\\
\label{sn118}
\frac{\partial S_{sol}}{\partial t}&\approx& \Bigl[\frac{\partial S_{sol}}{\partial z}w+\bigl(\frac{\partial S_{sol}}{\partial T}\bigr)\bigl(\frac{\partial T}{\partial t}\bigr)_{RAD}\Bigr]\nonumber\\
\frac{\Delta L_{i}}{\Delta t}\Bigr|_{nuc}&=&\frac{\Delta N_{i}}{\Delta t}\Bigr|_{nuc}x_{IN}\label{sn119}
\end{eqnarray}

where $x_{IN} = 10^{-12} kg$ is an arbitrary parameter for a nucleated ice nuclei mass. Here, we assume the change of supersaturation comes from the vertical motion of airmass and the radiative cooling. Meyers’s scheme produces the number concentration of cloud ice more than Phillips’s scheme, and the departure becomes large as supersaturation increases. This difference would come from the sampled air masses used in observational data that their schemes referred to, and also implicit dependencies of their schemes on temperature and aerosol species. It is expected that Phillips’s scheme is appropriate for the simulation of mid-latitude cirrus clouds because Phillips’s scheme is based on the air mass sampled in the free troposphere at the mid-latitude while Meyers’s scheme is based on the air mass sampled in the atmospheric boundary layer where ice nuclei is rich.

\subsubsection{Freezing}
The freezing process consists of two types of mechanisms. One is the homogenous freezing which is freezing of supercooled water droplets for themselves without the other agents. Another is the heterogeneous freezing, which is freezing of supercooled water droplets with insoluble part of aerosols dissolved in cloud droplets. We apply the same parameterizations of both the homogeneous freezing and the heterogeneous freezing as Seifert and Beheng (2006a). Cotton and Field (2002) parameterized homogeneous freezing rate for a single droplet by a fitting to the theoretical estimation by Jeffery and Austin (1997). We apply their parameterization as Seifert and Beheng (2006a),

\begin{eqnarray}
\frac{1}{f_{c}(x)}\frac{\partial f_{c}(x)}{\partial t}\Bigr|_{hom}=-xJ_{hom}(T_{c})\label{sn120}
\end{eqnarray}

where $J_{hom}$ is a homogeneous freezing rate ($kg^{-1}s^{-1}$) and $T_{c}$ is centigrade temperature. $J_{hom}$ is formulated as a function of temperature as follows,

\begin{eqnarray}
log_{10}(10^{-3}J_{hom})=
\left\{
\begin{array}{l}
25.63-243.4-14.75T_{c}-0.307T_{c}^{2},\;\;(-65^{o}C>T_{c}) \nonumber \\
-0.00287T_{c}^{3}-0.0000102T_{c}^{4},\;\;(-65^{o}C\leq T_{c}<-30^{o}C)\nonumber \\
-7.63-2.996(T_{c}+30),\;\;(-30^{o}C< T_{c})\nonumber 
\end{array}
\label{sn121}
\right.
\end{eqnarray}

Based on the equation for a single droplet, we can derive the equation for moments by integrating eq.\ref{sn120} as follows

\begin{eqnarray}
\frac{\partial N_{c}}{\partial t}\Bigr|_{hom}&=&-L_{c}J_{hom}=-N_{c}\bar{x}_{c}J_{hom}\label{sn122}\\
\frac{\partial L_{c}}{\partial t}\Bigr|_{hom}&=&-Z_{c}J_{hom}=-\frac{\Gamma\bigl(\frac{\nu_{c}+3}{\mu_{c}}\bigr)\Gamma\bigl(\frac{\nu_{c}+1}{\mu_{c}}\bigr)}{\Gamma\bigl(\frac{\nu_{c}+2}{\mu_{c}}\bigr)^{2}}L_{c}\bar{x}_{c}J_{hom}\label{sn123}
\end{eqnarray}

Here, we mention that eq.\ref{sn122} and eq.\ref{sn123} are expressed via filtered $\bar{x}_{c}$ in order to avoid artificial value of the prognostic variables. The homogeneous freezing for rain is not considered because it is negligible compared with the heterogeneous freezing due to their largeness. Although Cotton and Field (2002) considered also freezing point depression in freezing due to soluble aerosols, we don’t consider the effect because Seiki and Nakajima (2014) is not yet coupled with aerosol transport models.
Heterogeneous freezing is based on the empirical formulation by Biggs (1953) which is widely used in CRMs.

\begin{eqnarray}
\frac{1}{f(x)}\frac{\partial f(x)}{\partial t}=-xJ_{het}(T_{c})\label{sn124}
\end{eqnarray}

where $J_{het}$ is the heterogeneous freezing rate. $J_{het}$ is formulated as a function of temperature as follows,

\begin{eqnarray}
J_{het}=A_{het}exp(-B_{het}T_{c}-1)\label{sn125}
\end{eqnarray}

whare $A_{het}=0.2kg^{-1}s^{-1}$ and $B_{het}=0.65K^{-1}$ are empirically determined parameters. Similar to the homogeneous freezing, we can derive the equation for moments as follows,

\begin{eqnarray}
\frac{\partial N_{il}}{\partial t}\Bigr|_{het}&=&-N_{il}\bar{x}_{il}J_{het}\;\;(il=c,r)\label(sn126)\\
\frac{\partial L_{il}}{\partial t}\Bigr|_{het}&=&-\frac{\Gamma\bigl(\frac{\nu_{il}+3}{\mu_{il}}\bigr)\Gamma\bigl(\frac{\nu_{il}+1}{\mu_{il}}\bigr)}{\Gamma\bigl(\frac{\nu_{il}L2}{\mu_{il}}\bigr)^{2}}L_{il}\bar{x}_{il}J_{het}\;\;(il=c,r)\label{sn127}
\end{eqnarray}

Although the heterogeneous freezing should be also formulated as a function of aerosol concentration, here we apply simple formulation because our model is not yet coupled with an aerosol transport model.\\
Thus, these parameterizations don’t include the information of aerosols and it is considered that they assume background aerosols. The validity of the parameterization was demonstrated by Khain et al. (2001). Nevertheless their model also applied the same simple freezing parameterizations, they could represented the observational features of supercooled liquid water by Rosenfeld and Woodley (2000). Both freezing rates are shown in Fig. \ref{figsn2-22}. The heterogeneous freezing is dominated at temperature over -35 degrees Celsius. At the temperature, supercooled liquid water is mixed with ice particles. In contrast, the homogeneous freezing rate suddenly increase below -35 degrees Celsius. Liquid water droplets have been hardly observed below the temperature of -40 degrees Celsius (Rosenfeld and Woodley, 2000). The feature can be represented by using the parameterization.

\subsubsection{Melting}
Melting process is the same as Seifert and Beheng (2006a) based on Pruppacher and Klett (1997). Theoretical treatment of this process is similar to the condensation process. The differences are\\
1.Time scale of evaporation of a single particle is replaced by that of fusion of a single particle.\\
2.Vaporization of melted particle is considered in a balance equation of vapor and thermal diffusion.\\
As a result, the melting rate of a single ice particle is described as follows,

\begin{eqnarray}
\frac{dx_{js}}{dt}\Bigr|_{mlt}=&-&\frac{2\pi D_{js}}{L_{f0}}\Bigl[K_{T}(T-T_{0})\frac{D_{T}}{D_{v}}F_{vf}(x_{js})\nonumber\\
&+&\frac{D_{v}L_{v0}}{R_{v}}\bigr(\frac{p_{v}}{T}-\frac{p_{sw}(T_{0})}{T}\bigr)F_{vf}(x_{js})\Bigr]\;\;(js=i,s,g)\label{sn128}
\end{eqnarray}

where $D_{T}$ is diffusivity of heat, and $T_{0} = 273.15 K$ is melting point. The growth rate of moments can be formulated by using a melting time scale $\tau_{mlt}$ defined as follows, 

\begin{eqnarray}
\tau_{mlt}&\equiv&\frac{x_{js}}{\bigl(\frac{dx_{js}}{dt}\bigr)_{mlt}}\label{sn129}\\
\frac{\partial M_{js}^{k}}{\partial t}\Bigr|_{mlt}&=&-\int_{0}^{\infty}\frac{x^{k}f_{js}(x)}{\tau_{mlt}}dx\nonumber\\
&=&-\frac{2\pi}{L_{f0}}\Bigl[\frac{K_{T}D_{T}}{D_{v}}(T-T_{0})+\frac{D_{v}L_{v0}}{R_{v}}\bigl(\frac{p_{v}}{T}-\frac{p_{sw}(T_{0})}{T_{0}}\bigr)\Bigr]\nonumber\\
&\times& N_{js}D_{js}(\bar{x}_{js})x_{js}^{n-1}\bar{F}_{vf,js}
\label{sn140}
\end{eqnarray}

We mention that this scheme allows the existence of ice particles over the melting point ($T>273.15 K$) since the melting time scale of large particles can be longer than a simulation time step. Actually, ice particles are transitionally converted into liquid droplets and the type of hydrometeor is not changed in the transition. However, here we assume that ice water mass is converted into liquid water mass in a certain melting time scale and the part of liquid water mass is categorized as the other hydrometeors. Here, graupel and snow is converted into rain, and ice is converted into cloud. This formulation has a possibility to cause an artificial production of cloud or rain in melting. Validation experiments and impact assessment are necessary in future.

\subsubsection{Collection process}
The collection processes are the same as Seifert and Beheng (2001), Seifert and Beheng (2006a) and Seifert (2008). The collection processes among hydrometeors are summarized in Table \ref{table_sn14-16}. In this section, the formulations of the collection processes, auto-conversion, accretion, aggregation, riming, and their related processes are described.


\begin{table}[h]
\begin{center}
\caption{Hydrometeors that result from binary collision. Collecting hydrometeors are written in the 1st row and collected hydrometeors are written in the 1st column.}
\label{table_sn14-16}
\scalebox{0.5}{
\begin{tabular}{cccccc}
\hline
             &  cloud water & rain & cloud ice & snow & graupel  \\ \hline
cloud water  &  rain        & -    & -         & -    & -        \\ \hline
rain         &  rain        & rain & rain($T>273K$), graupel($T<273K$) & rain($T>273K$), graupel($T<273K$) & rain($T>273K$) \\ \hline
cloud ice    &  cloud ice   & -    & snow      & -    & - \\ \hline
snow         &  snow        & -    & -     & snow & - \\ \hline
graupel      &  graupel     & graupel($T<273K$) & graupel & graupel & - \\ \hline
\end{tabular}
}
\end{center}
\end{table}

\subsubsection{Self-collection, auto-conversion, and accretion}
With a few assumptions and a little algebra, Seifert and Beheng (2001) derived the analytical formulations of the self-collection, auto-conversion, and accretion processes as follows,

\begin{eqnarray}
\frac{\partial N_{c}}{\partial t}\Bigr|_{aut+sle}&=&-k_{cc}\frac{(\nu_{c}+2)}{(\nu_{c}+1)}\frac{\rho_{0}}{\rho}L_{c}^{2}\label{sn142}\\
\frac{\partial L_{c}}{\partial t}\Bigr|_{aut}&=&-\frac{k_{cc}}{20x^{*}}\frac{(\nu_{c}+2)(\nu_{c}+4)}{(\nu_{c}+1)^{2}}\frac{\rho_{0}}{\rho}L_{c}^{2}x_{c}^{2}\label{sn143}\\
\frac{\partial N_{c}}{\partial t}\Bigr|_{aut}&=&\frac{2}{x^{*}}\frac{\partial L_{c}}{\partial t}\Bigr|_{aut}\label{sn144}\\
\frac{\partial N_{r}}{\partial t}\Bigr|_{aut}&=&-\frac{1}{2}\frac{\partial N_{c}}{\partial t}\Bigr|_{aut}=-\frac{1}{x^{*}}\frac{\partial L_{c}}{\partial t}\Bigr|_{aut}\label{sn145}\\
\frac{\partial N_{c}}{\partial t}\Bigr|_{acc}&=&-k_{cr}N_{c}L_{r}\bigl(\frac{\rho_{0}}{\rho}\bigr)^{1/2}\label{sn146}\\
\frac{\partial L_{c}}{\partial t}\Bigr|_{acc}&=&-k_{cr}L_{c}L_{r}\bigl(\frac{\rho_{0}}{\rho}\bigr)^{1/2}\label{sn147}\\
\frac{\partial N_{r}}{\partial t}\Bigr|_{slc}&=&-k_{rr}L_{r}L_{r}\bigl(\frac{\rho_{0}}{\rho}\bigr)^{1/2}\label{sn148}
\end{eqnarray}

with $k_{rr} = 4.33 m^{3}kg^{-1}s^{-1}$, and where density factors are introduced by Seifert and Beheng (2006a) in order to correct the effect of terminal velocity on the collision efficiency. In addition to the analytical derivation, Seifert and Beheng (2001) made corrections depending on the development stage by using the dimensionless internal time scale. Since moment bulk methods cannot represented complicated changes of high-order moments, the corrections are necessary as DSD undergoes evolution by the collection processes. Firstly, the auto-conversion rate is represented by $\tau$ by substituting eq.\ref{sn141} to eq.\ref{sn143},

\begin{eqnarray}
\frac{\partial \tau}{\partial t}\Bigr|_{aut}=\frac{k_{cc}}{20x^{*}}\frac{(\nu_{c}+2)(\nu_{c}+4)}{(\nu_{c}+1)^{2}}\frac{\rho_{0}}{\rho}x_{c}^{2}L(1-\tau^{2})\label{sn149}
\end{eqnarray}

The assumptions used in the derivation of eq.\ref{sn149} are valid for the initial stage of collisional growth. Therefore, the additional collection by a universal function $\phi_{aut}$ was introduced by Seifert and Beheng (2001) as follows,

\begin{eqnarray}
\frac{\partial \tau}{\partial t}\Bigr|_{aut}=\frac{k_{cc}}{20x^{*}}\frac{(\nu_{c}+2)(\nu_{c}+4)}{(\nu_{c}+1)^{2}}\frac{\rho_{0}}{\rho}x_{c}^{2}L_{c}^{2}x_{c}^{2}\bigl[(1-\tau^{2})+\phi_{aut}(\tau)\bigr]\label{sn150}
\end{eqnarray}

Similarly, the correction for the accretion rate is also made by a universal function $\phi_{acc}$,

\begin{eqnarray}
\frac{\partial \tau}{\partial t}\Bigr|_{acc}=k_{cr}L\bigl(\frac{\rho_{0}}{\rho}\bigr)^{1/2}(1-\tau)\tau\phi_{acc}(\tau)\label{sn151}
\end{eqnarray}

In contrast to the correction for the auto-conversion rate, the assumptions used in the derivation of the accretion rate is valid for the mature stage of the collisional growth. Therefore a correction function is multiplied so that $\phi_{aut}$ becomes zero for the beginning of the collisional growth and one for the mature stage of the collisional growth. Here, it is recognized that the growth rate of the dimensional internal time scale is proportional to LWC in eq.\ref{sn150} and eq.\ref{sn151}. Therefore, the parameterizations developed by Seifert and Beheng (2001) satisfy the similarity included in the SCE. Finally, the universal functions are derived by fitting to the results by a bin cloud microphysics model,

\begin{eqnarray}
\phi_{aut}(\tau)&=&400\tau^{0.7}(1-\tau^{0.7})^{3}\label{152}\\
\phi_{acc}(\tau)&=&\bigl(\frac{\tau}{\tau+5\times 10^{-5}}\bigr)^{4}\label{153}
\end{eqnarray}

These functions are shown in Fig.\ref{figsn2-21}.\\
Here, we mention that the fitting curves of the universal functions highly depend on the calculation by a bin cloud microphysics model. In fact, the functions proposed by Seifert and Beheng (2006a) were modified from the original functions by Seifert and Beheng (2001) with the progresses in the estimation of the collection kernel. We have to update the parameterizations when more sophisticated collection kernel will be estimated than the one used by Seifert and Beheng (2006a)

\subsubsection{Break-up}
Large rain droplets are not always stable in the collision process. It was observed that large rain droplets could break up into many small droplets after the collision ( Low and Lists, 1982 ). Collisional break-up sustain mean droplet size so as not to grow extremely larger and cause strong precipitation. As discussed by Hu and Srivastava (1995), the system of collision, coalescence and break-up reaches the equilibrium condition between coalescence and break-up after the sufficient long time. Consequently the form of the DSD of rain is led to the self-similar equilibrium DSD with the equilibrium mean diameter $\bar{D}_{eq}$ . Seifert and Beheng (2006a) simply parameterized the break-up process as a relaxation of the DSD with the mean diameter more than $\bar{D}_{eq}$ to the self-similar equilibrium DSD.

\begin{eqnarray}
\frac{\partial N_{r}}{\partial t}\Bigr|_{brk}=-\bigl[\phi_{brk}(\Delta \bar{D}_{r})+1\bigr]\frac{\partial N_{r}}{\partial t}\Bigr|_{slc}\label{sn154}
\end{eqnarray}

where $\phi_{brk}$ is a universal function of break-up, and $\Delta \bar{D}_{r}\equiv \bar{D}_{r}-\bar{D}_{eq}$, $\bar{D}_{r}$ is the mean volume diameter of rain, with $\bar{D}_{eq} = 1.1 mm$ according to Seifert (2008). The universal function was derived by a fitting to the results by a bin cloud microphysics model based on ( Seifert et al. 2005 ), and formulated as follows,

\begin{eqnarray}
\phi_{brk}(\Delta\bar{D}_{r})=
\left\{
\begin{array}{l}
2exp(\kappa_{brk}\Delta\bar{D}_{r})-1,\;\;(\bar{D}_{r}>\bar{D}_{eq}) \\
\kappa_{brk}\Delta\bar{D}_{r}+1,\;\;(\bar{D}_{eq}\geq \bar{D}_{r}>0.35\times 10^{-3}m) \\
-1,\;\;(0.35\times10^{-3}>\bar{D}_{r}) 
\label{sn155}
\end{array}
\right.
\end{eqnarray}

with $\kappa_{brk} = 2.3 \times 10^{3} m^{-1}$, and $k_{brk} = 1000 m^{-1}$. For the mean volume diameter less than $0.35 \times 10^{-3}m$, break-up is neglected.

\subsubsection{Mixed-phase collection}
In the previous sections, the collection processes are limited for warm cloud. In this section, the collection processes among mixed phase clouds are described. In contrast to warm cloud, there exist many kinds of particles in cold cloud as discussed in section 2.1. Since the variety of the shape and their coexistence condition differs case by case, there are no systematized theory, observation, and experiments for the mixed phase collection processes. Therefore, Seifert and Beheng (2006a) proposed a general formulation of the collisional interactions among hydrometeors starting from the simplification of the SCE. Due to the variety of the types of hydrometeors, the patterns of the interaction are categorized into following five cases.\\
1.A particle of hydrometeor “a” collects “b” and then the collecting particle “a” grow. This pattern is corresponding to the collision between ice and cloud (ic), snow and cloud (sc), graupel and cloud (gc), snow and ice (si), graupel and rain (gr), and graupel and snow (gs).\\
2.A particle of hydrometeor “a” collects “b” and then the other particle “c” is produced. This pattern is corresponding to the collision between rain and ice (ri), and rain and snow (rs).\\
3.A particle of hydrometeor “a” collects “a” and then the other particle “b” is produced. This pattern is corresponding to the collision between ice and ice (ii).\\
4.A particle of hydrometeor “a” collects “a” and then the collecting particle “a” grows. This pattern is corresponding to the collision between snow and snow (ss).\\
In the following sections, we introduce the derivation of the mixed phase collection corresponding to the five cases.

\subsubsection{The collision case 1: a+b $\rightarrow$ a}
In contrast to the SCE for warm cloud, the production term and reduction term are slightly different in the binary collision between two types of hydrometeors. The reduction term of the hydrometeor “b” and the production term of the hydrometeor “a” are described as follows,

\begin{eqnarray}
\frac{\partial f_{b}(y)}{\partial t}\Bigr|_{col,ab}&=&-\int_{0}^{\infty}f_{b}(y)f_{a}(x)K_{ab}(x,y)dx\label{sn156}\\
\frac{\partial f_{b}(y)}{\partial t}\Bigr|_{col.ab}&=&\int_{0}^{\infty}f_{a}(x-y)f_{b}(x)K_{ab}(x-y,y)dx\nonumber\\
&-&\int_{0}^{\infty}f_{a}(x)f_{b}(y)K_{ab}(x,y)dy\label{sn157}
\end{eqnarray}

Here, the formulation of the collection kernel is often described by the swept volume of large particle as follows,

\begin{eqnarray}
K_{ab}(x,y)\equiv E_{ab}(x,y)\frac{\pi}{4}\bigl[D_{a}(x)+D_{b}(y)\bigr]^{2}\bigl[v_{t,a}(x)-v_{t,b}(y)\bigr]\label{sn158}
\end{eqnarray}

where $E_{ab}$ is the collection efficiency, $D_{i}$ and $v_{t,i}$ are diameter and terminal velocity respectively. We can derive the growth rate of the kth moments by integrating eq.\ref{sn156} and eq.\ref{sn157},

\begin{eqnarray}
\frac{\partial M_{b}^{k}}{\partial t}\Bigr|_{col,ab}&=&\frac{\pi}{4}\int_{0}^{\infty}\int_{0}^{\infty}f_{b}(y)f_{a}(x)\bigl[D_{a}(x)+D_{b}(y)\bigr]^{2}\nonumber\\
&\times&\bigl|v_{t,a}(x)-v_{t,b}(y)\bigr|E_{ab}(x,y)y^{k}dxdy\label{sn159}\\
\frac{\partial M_{a}^{k}}{\partial t}\Bigr|_{col,ab}&=&\frac{\pi}{4}\int_{0}^{\infty}\int_{0}^{\infty}f_{a}(x)f_{b}(y)\bigl[D_{a}(x)+D_{b}(y)\bigr]^{2}\nonumber\\
&\times&\bigl|v_{t,a}(x)-v_{t,b}(y)\bigr|E_{ab}(x,y)\bigl[(x+y)^{k}-x^{k}\bigr]dxdy\label{sn160}
\end{eqnarray}

Here, the difference of the terminal velocities, and the collection efficiency in the integrand make the analytical integration of eq.\ref{sn159} and eq.\ref{sn160} impossible. In the past, many researchers have made effort to express the integration by approximation. Seifert and Beheng (2006a) achieved the integration by using the approximation proposed by Wisner et al. (1972) with some improvements. Hereafter, we only demonstrate the equations for the 0th moment N and the 1st moment L.

\begin{eqnarray}
\frac{\partial L_{b}}{\partial t}\Bigr|_{col,ab}&\cong&-\frac{\pi}{4}\bar{E}_{ab}\bar{\Delta v_{t,ab}^{1}}\nonumber\\
&\times&\int_{0}^{\infty}\int_{0}^{\infty}f_{a}(x)f_{b}(y)\bigl[D_{a}(x)+D_{b}(y)\bigr]^{2}ydxdy\label{sn161}\\
\frac{\partial L_{a}}{\partial t}\Bigr|_{col,ab}&\cong&\frac{\pi}{4}\bar{E}_{ab}\bar{\Delta v_{t,ab}^{1}}\int_{0}^{\infty}\int_{0}^{\infty}f_{a}(x)f_{b}(y)\bigl[D_{a}(x)+D_{b}(y)\bigr]^{2}ydxdy\label{sn162}\nonumber\\
&=&-\frac{\partial L_{b}}{\partial t}\label{sn162}\\
\frac{\partial N_{b}}{\partial t}\Bigr|_{col,ab}&\cong&-\frac{\pi}{4}\bar{E}_{ab}\bar{\Delta v_{t,ab}^{0}}\int_{0}^{\infty}\nonumber\\
&\times&\int_{0}^{\infty}f_{a}(x)f_{b}(y)\bigl[D_{a}(x)+D_{b}(y)\bigr]^{2}dxdy\label{sn163}\\
\frac{\partial N_{a}}{\partial t}\Bigr|_{col,ab}&=&0\label{sn164}
\end{eqnarray}

where $\bar{E}_{ab}$ is the mean collection efficiency, and $\bar{\Delta v_{t,ab}^{k}}$ is a characteristic velocity difference. Thus, the integrand are transformed so as to be integrated analytically and the problems result in the evaluation of $\bar{E}_{ab}$ and $\bar{\Delta v_{t,ab}^{k}}$. Some cloud microphysics schemes evaluate $\bar{\Delta v_{t,ab}^{k}}$ as the approximation proposed by Wisner (1972),

\begin{eqnarray}
\bar{\Delta v_{t,ab}^{k}}=\bigl|\bar{v}_{M_{a}^{k}}(\bar{x}_{a})-\bar{v}_{M_{b}^{k}}(\bar{y}_{b})\bigr|\label{sn165}
\end{eqnarray}

The characteristic velocity difference is simply approximated by the difference between the mass weighted mean terminal velocity of the hydrometeors. This is equivalent to the physical assumption that all the particles are falling with the same terminal velocity equal to the mass weighted mean terminal velocity. However, as pointed out by Seifert and Beheng (2006a), the formulation underestimates the term for the similar mass weighted mean terminal velocities even though larger particles preferentially collect smaller particles due to their differences of the terminal velocities. Seifert and Beheng (2006a) applied an alternate approximation in order to avoid the abovementioned problem as follows,

\begin{eqnarray}
\bar{\Delta v_{t,ab}^{k}}=\Bigl[\frac{\int_{0}^{\infty}\int_{0}^{\infty}{v_{t,a}(x)-v_{t,b}(y)}^{2}D_{a}^{2}D_{b}^{2}f_{a}(x)f_{b}(y)y^{k}dxdy}
{\int_{0}^{\infty}\int_{0}^{\infty}D_{a}^{2}D_{b}^{2}f_{a}(x)f_{b}(y)y^{k}dxdy}\Bigr]^{1/2}\label{sn166}
\end{eqnarray}

The integrand can be integrated straightforwardly assuming the diameter and the terminal velocity follow power laws as given in section 2.1. Here, we apply the equivalent projected area diameter in contrast to the maximum dimension applied by Seifert and Beheng (2006a),

\begin{eqnarray}
D&=&D_{C}(x)=\bigl(\frac{4}{\pi}A\bigr)^{1/2}=a_{C}x^{b_{C}}\label{sn167}\\
a_{C}&=&\bigl(\frac{4}{\pi}a_{ax}\bigr)^{1/2},\;\;b_{C}=\frac{b_{ax}}{2}\nonumber
\end{eqnarray}

Since the diameter is used in the calculation of collisional cross section, maximum dimension overestimates collisional cross section for needle or column like crystals. Firstly, the denominator in eq.\ref{sn166} is transformed as follows,

\begin{eqnarray}
& &\int_{0}^{\infty}\int_{0}^{\infty}D_{C,a}^{2}D_{C,b}^{2}f_{a}(x)f_{b}(y)y^{k}dxdy\nonumber\\
&=&a_{C_{a}}^{2}a_{C_{b}}^{2}M_{a}^{2b_{C,a}}M_{b}^{2b_{C,b}+k}\nonumber\\
&=&D_{C,a}^{2}(\bar{x})D_{C,b}^{2}(\bar{y})\bar{y}^{k}\nonumber\\
&\times&\frac{\Gamma\bigl(\frac{2b_{C,a}+\nu_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{\nu_{a}+1}{\mu_{a}}\bigr)}
\frac{\Gamma\bigl(\frac{2b_{C,b}+k+\nu_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{\nu_{a}+1}{\mu_{a}}\bigr)}\nonumber\\
&\times&\Bigl[\frac{\Gamma\bigl(\frac{\nu_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{\nu_{a}+1}{\mu_{a}}\bigr)}\Bigl]^{2_{b_{C,a}}}
\Bigl[\frac{\Gamma\bigl(\frac{\nu_{b}+1}{\mu_{b}}\bigr)}{\Gamma\bigl(\frac{\nu_{b}+1}{\mu_{b}}\bigr)}\Bigl]^{2_{b_{C,b}}+k}\label{sn168}
\end{eqnarray}

Secondly, the numerator in eq.\ref{sn166} is transformed as follows,


\begin{eqnarray}
& &\int_{0}^{\infty}\int_{0}^{\infty}\bigl[v_{t,a}(x)-v_{t,b}(y)\bigr]^{2}D_{C,b}^{2}D_{C,b}^{2}f_{a}(x)f_{b}(y)y^{k}dxdy\nonumber\\
&=&a_{C_{a}}^{2}a_{C_{b}}^{2}\bigl[a_{v,a}^{2}M_{a}^{2b_{C,a}+2b_{v,a}}\nonumber\\
&+&M_{b}^{2b_{C,b}+k}-2a_{v,a}a_{v,b}M_{a}^{2b_{C,a}+b_{v,a}}M_{b}^{2b_{C,b}+b_{v,b}+k}+a_{v,b}^{2}M_{a}^{2b_{C,a}}M_{b}^{2b_{C,b}+2b_{v,b}+k}\bigr]\nonumber\\
&=&D_{C,a}^{2}(\bar{x})D_{C,b}^{2}(\bar{y})\bar{y}^{k}\nonumber\\
%\Bigl[
&+&v_{t,a}^{2}(\bar{x})
\frac{\Gamma\bigl(\frac{2b_{C,a}+2b_{v,a}+v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{v_{a}+1}{\mu_{a}}\bigr)}
\frac{\Gamma\bigl(\frac{2b_{C,b}+k+v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{v_{a}+1}{\mu_{a}}\bigr)}
\Bigl[\frac{\Gamma\bigl(\frac{v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{v_{a}+2}{\mu_{a}}\bigr)}\Bigr]^{2_{b_{C,a}}+2b_{v,a}}
\Bigl[\frac{\Gamma\bigl(\frac{v_{b}+1}{\mu_{b}}\bigr)}{\Gamma\bigl(\frac{v_{b}+2}{\mu_{b}}\bigr)}\Bigr]^{2_{b_{C,a}}+k}\nonumber\\
&=&2v_{t,a}(\bar{x})v_{t,b}(\bar{y})
\frac{\Gamma\bigl(\frac{2b_{C,a}+b_{v,a}+v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{v_{a}+1}{\mu_{a}}\bigr)}
\frac{\Gamma\bigl(\frac{2b_{C,b}+b_{v,a}+k+v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{v_{a}+1}{\mu_{a}}\bigr)}\nonumber\\
&\times&\Bigl[\frac{\Gamma\bigl(\frac{v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{v_{a}+2}{\mu_{a}}\bigr)}\Bigr]^{2_{b_{C,a}}+b_{v,a}}
\Bigl[\frac{\Gamma\bigl(\frac{v_{b}+1}{\mu_{b}}\bigr)}{\Gamma\bigl(\frac{v_{b}+2}{\mu_{b}}\bigr)}\Bigr]^{2_{b_{C,a}}+b_{v,b}+k}\nonumber\\
&+&v_{t,b}^{2}(\bar{y})
\frac{\Gamma\bigl(\frac{2b_{C,a}+v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{v_{a}+1}{\mu_{a}}\bigr)}
\frac{\Gamma\bigl(\frac{2b_{C,b}+2b_{v,a}+k+v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{v_{a}+1}{\mu_{a}}\bigr)}
\Bigl[\frac{\Gamma\bigl(\frac{v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{v_{a}+2}{\mu_{a}}\bigr)}\Bigr]^{2_{b_{C,a}}}\nonumber\\
&\times&\Bigl[\frac{\Gamma\bigl(\frac{v_{b}+1}{\mu_{b}}\bigr)}{\Gamma\bigl(\frac{v_{b}+2}{\mu_{b}}\bigr)}\Bigr]^{2_{b_{C,a}}+2b_{v,b}+k}\label{sn169}
\end{eqnarray}

Finally, the characteristic velocity difference are derived by substituting eq.\ref{sn168} and eq.\ref{sn169} into \ref{sn166},

\begin{eqnarray}
\bar{\Delta v_{t,ab}^{k}}&=&\bigl[\theta_{a}^{0}v_{t,a}^{2}(\bar{x})-\theta_{ab}^{k}v_{t,a}(\bar{x})v_{t,b}(\bar{y})+\theta_{b}^{k}v_{t,b}^{2}\bigr]^{1/2}\label{sn170}\\
\theta_{a}^{k}&=&\frac{\Gamma\bigl(\frac{2b_{C,a}+2b_{v,a}+k+v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{2b_{C,a}+k+v_{a}+1}{\mu_{a}}\bigr)}\Bigl[\frac{\Gamma\bigl(\frac{v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{v_{b}+2}{\mu_{b}}\bigr)}\Bigr]\{2b_{v,a+k}\label{sn171}\\
\theta_{ab}^{k}&=&2\frac{\Gamma\bigl(\frac{2b_{C,a}+b_{v,a}+v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{2b_{C,a}+v_{a}+1}{\mu_{a}}\bigr)}\frac{\Gamma\bigl(\frac{2b_{C,b}+b_{v,b}+k+v_{b}+1}{\mu_{b}}\bigr)}{\Gamma\bigl(\frac{2b_{C,b}+k+v_{b}+1}{\mu_{b}}\bigr)}\nonumber\\
&\times&\Bigl[\frac{\Gamma\bigl(\frac{v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{v_{a}+2}{\mu_{a}}\bigr)}\Bigr]^{b_{v,a}}\Bigl[\frac{\Gamma\bigl(\frac{v_{b}+1}{\mu_{b}}\bigr)}{\Gamma\bigl(\frac{v_{b}+2}{\mu_{b}}\bigr)}\Bigr]^{b_{v,b}}\label{sn172}
\end{eqnarray}

Here, it is noticed that the notation “ab” in $\theta_{ab}^{k}$ is not symmetric because $\theta_{ab}^{k}$ is weighted by the mass of collected particle to the power of “k”. Integrations in eq.\ref{sn161} and eq.\ref{sn163} are similarly calculated as follows, 


\begin{eqnarray}
& &\int_{0}^{\infty}\int_{0}^{\infty}f_{a}(x)f_{b}(y){D_{a}(x)+D_{b}(y)}^{2}y^{k}dx\nonumber\\
&=& a_{C_{a}}^{2}M_{a}^{2b_{C,a}}M_{b}^{k}+2a_{C_{a}}a_{C_{b}}M_{a}^{b_{C,a}}M_{b}^{b_{C,b}+k}+a_{C_{b}}^{2}M_{a}^{0}M_{b}^{2b_{C,b}+k}\nonumber\\
&=& \delta_{a}^{0}D_{C,a}^{2}(\bar{x})N_{a}M_{b}^{k}+\delta_{ab}^{k}D_{C,a}(\bar{x})D_{C,b}(\bar{y})N_{a}N_{b}\bar{y}^{k}\nonumber\\
&+&\delta_{b}^{k}D_{C,b}^{2}(\bar{y})N_{a}N_{b}\bar{y^{k}}\label{sn173}\\
\delta_{a}^{k}&=&\frac{\Gamma\bigl(\frac{2b_{C,b}+k+v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{\mu_{a}+1}{\mu_{a}}\bigr)}\Bigl[\frac{\Gamma\bigl(\frac{v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{v_{a}+2}{\mu_{a}}\bigr)}\Bigr]^{2_{b_{C,a}}+k}\label{sn174}\\
\delta_{ab}^{k}&=& 2\frac{\Gamma\bigl(\frac{b_{C,a}+v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{v_{a}+1}{\mu_{a}}\bigr)}\frac{\Gamma\bigl(\frac{b_{C,b}+k+v_{b}+1}{\mu_{b}}\bigr)}{\Gamma\bigl(\frac{v_{b}+1}{\mu_{b}}\bigr)}\Bigl[\frac{\Gamma\bigl(\frac{v_{a}+1}{\mu_{a}}\bigr)}{\Gamma\bigl(\frac{v_{a}+2}{\mu_{a}}\bigr)}\Bigr]^{b_{C,a}}\Bigl[\frac{\Gamma\bigl(\frac{v_{b}+1}{\mu_{b}}\bigr)}{\Gamma\bigl(\frac{v_{b}+2}{\mu_{b}}\bigr)}\Bigr]^{b_{C,b}+k}\label{sn175}
\end{eqnarray}

Here, $\delta_{ab}^{k}$ is also asymmetry in “ab” as $\theta_{ab}^{k}$. Finally, the growth rates of the prognostic moments are represented as follows,


\begin{eqnarray}
\frac{\partial L_{a}}{\partial }\Bigr|_{col,ab}&=&\frac{\pi}{4}\bar{E}_{ab}N_{a}L_{b}{\delta_{a}^{0}D_{C,a}^{2}(\bar{x}_{a})+\delta_{ab}^{1}D_{C,a}(\bar{x}_{a})D_{C,b}(\bar{x}_{b})+\delta_{b}^{1}D_{C,b}^{2}(\bar{x}_{b})}\nonumber\\
&\times&[\theta_{a}^{0}v_{t,a}^{2}(\bar{x}_{a})-\theta_{ab}^{1}v_{t,a}(\bar{x}_{a})v_{t,b}(\bar{x}_{b})+\theta_{b}^{1}v_{t,b}^{2}(\bar{x}_{b})+\sigma_{a}+\sigma_{b}]^{1/2}\label{sn176}\\
\frac{\partial L_{b}}{\partial t}\Bigr|_{col,ab}&=&-\frac{\partial L_{a}}{\partial t}\Bigl|_{col,ab}\label{sn177}\\
\frac{\partial N_{b}}{\partial }\Bigr|_{col,ab}&=&\frac{\pi}{4}\bar{E}_{ab}N_{a}N_{b}{\delta_{a}^{0}D_{C,a}^{2}(\bar{x}_{a})+\delta_{ab}^{0}D_{C,a}(\bar{x}_{a})D_{C,b}(\bar{x}_{b})+\delta_{b}^{0}D_{C,b}^{2}(\bar{x}_{b})}\nonumber\\
&\times&[\theta_{a}^{0}v_{t,a}^{2}(\bar{x}_{a})-\theta_{ab}^{0}v_{t,a}(\bar{x}_{a})v_{t,b}(\bar{x}_{b})+\theta_{b}^{0}v_{t,b}^{2}(\bar{x}_{b})+\sigma_{a}+\sigma_{b}]^{1/2}\label{sn178}\\
\frac{\partial N_{b}}{\partial t}\Bigr|_{col,ab}&=&0\label{sn179}
\end{eqnarray}

where $\sigma_{a}$ and $\sigma_{b}$ are constant variances due to the probabilities of the terminal velocity of particles. Seifert and Beheng (2006a) proposed the concept to mimic an introduction of the effect of turbulence to the collection kernel with the use of the constant variances. The constant variances are only applied to ice and snow with $\sigma_{i}= \sigma_{s} = 0.2 m s^{-1}$ while no variances are assumed for the other particles.

\subsubsection{The collection efficiencies of ice particles}
The collection efficiencies of ice particles are poorly understood due to their varieties and the lack of the systematic observations. In addition, the efficiencies cannot be approximated by power laws. Therefore, Seifert and Beheng (2006a) described them in a simple way. The collection efficiency $E_{ab}$ can be decomposed into two part of efficiencies, the collision efficiency $E_{col}$ and the sticking efficiency $E_{stick}$. This means that two particles stochastically collide each other with $E_{col}$, and then they stick each other with $E_{stick}$. It is considered that the mean possibility of collection $\bar{E}_{ab}$ is parameterized by the multiplying $\bar{E}_{col}$ by $\bar{E}_{stick}$.

\begin{eqnarray}
\bar{E}_{ab}=\bar{E}_{col,ab}\times\bar{E}_{stick,ab}\label{sn180}
\end{eqnarray}

The mean collision efficiencies of each gydrometeor are given as follows,

\begin{eqnarray}
\bar{E}_{col,ab}&=&\bar{E}_{col,a}\times\bar{E}_{colk,b}\label{sn181}\\
\bar{E}_{col,c}&=&
\left\{
\begin{array}{l}
0,\;\;(\bar{D}_{c}<\bar{D}_{c,0}) \\
\frac{\bar{D}_{c}-\bar{D}_{c,0}}{\bar{D}_{c,1}-\bar{D}_{c,0}},\;\;(\bar{D}_{c,0}\leq\bar{D}_{c}\leq\bar{D}_{c,1}) \\
1,\;\;(\bar{D}_{c,1}<\bar{D}_{c}) \\
\end{array}
\label{sn182}
\right.\\
\bar{E}_{col,r}&=&1\label{sn183}\\
\bar{E}_{col,js}&=&
\left\{
\begin{array}{l}
0,\;\;(\bar{D}_{js}<150nm) \\
\bar{E}_{col,max,js},\;\;(\bar{D}_{js}>150nm),\;\;\;(js=i,s,g)
\label{sn184}
\end{array}
\right.
\end{eqnarray}


with $\bar{D}_{c,0} = 15\mu m$, $\bar{D}_{c,1} = 40 \mu m$, $\bar{E}_{col,max,i}=\bar{E}_{col,max,s}=0.8$ , and $\bar{E}_{col,max,g}=1.0$. Furthermore, the mean collision efficiency of one is assumed in the collision between rain droplets and ice particles, and the collision between ice particles. These values are so empirical that further investigations and assessments are required.\\
The sticking efficiency is considered only in the case of the collision between ice particles. Otherwise, the efficiency is assumed as one. It is known that the stick efficiency depends on the enviromental condition around ice particles and the shape of ice particle (Pruppacher and Klett, 1997). Ice crystals with many branches are likely to stick each other. In addition, the ice particles under wet conditions are also likely to coalescence because of the surface condition of ice particles. Since these dependencies of the stick efficiency are poorly understood, some simple formulations were proposed by past researchers. Lin et al. (1983) proposed the following formulation,

\begin{eqnarray}
\bar{E}_{stick}(T)=
\left\{
\begin{array}{l}
exp[0.09\times T_{c}],\;\;(T_{c}\leq 0^{o}C) \\
1,\;\;(T_{c}> 0^{o}C) 
\label{sn185}
\end{array}
\right.
\end{eqnarray}

In contrast to their formulation, Cotton et al. (1986), proposed an alternative formulation based on observations (Hallgren and Hosler, 1960) as follows,

\begin{eqnarray}
\bar{E}_{stick}(T_{p})=min(10^{0.035(T_{p}-273.15)-0.7},0.2)\label{sn186}
\end{eqnarray}

where $T_{p}$ is particle surface temperature. They also diagnosed the departure of particle surface temperature from the enviroment due to phase change in the calculation. In addition, their formulation has a upper limit to reduce the efficiency as observations showed. In a similar way, Khain and Sednev (1996) proposed a formulation based on other observations (Hosler et al., 1957; Rogers et al., 1974). Their formulation also depends on vapor pressure as follows,

\begin{eqnarray}
\bar{E}_{stick}&=&min\bigl(\delta E\frac{p_{v}}{p_{si}},1\bigr)\label{sn187}\\
\delta E&=&max(a_{\delta}+b_{\delta}T_{c}+c_{\delta}T_{c}^{2}+d_{\delta}T_{c}^{3},0)\label{sn188}
\end{eqnarray}

with $a_{\delta} = 0.883$, $b_{\delta} = 0.093$, $c_{\delta} = 0.00348$, and $d_{\delta} = 4.5185 \times 10^{-5}$. In this study, the formulation proposed by Lin et al. (1983) is applied following Seifert and Beheng (2006a). These efficiencies are shown in Fig.\ref{figsn2-22} with the various obeservation data from Pruppacher and Klett (1997). The further investigations and assessments are necessary to determine which one is better than others although there are less information for making a decision.


\subsubsection{The collision case 2: a+b $\rightarrow$ c}
 The case is the same as the case 1 except for the growing particles. 

\begin{eqnarray}
\frac{\partial f_{b}(y)}{\partial t}\Bigr|_{col,abs}&=&-\int_{0}^{\infty}f_{b}(y)f_{a}(x)K_{ab}(x,y)dx\label{sn189}\\
\frac{\partial f_{a}(x)}{\partial t}\Bigr|_{col,abs}&=&-\int_{0}^{\infty}f_{a}(x)f_{b}(y)K_{ab}(x,y)dy\label{sn190}
\end{eqnarray}

Similarly, the growth rates of the prognostic moments are derived as follows,

\begin{eqnarray}
\frac{\partial L_{a}}{\partial t}\Bigr|_{col,ab}&=&-\frac{\pi}{4}\bar{E}_{ab}\bar{\Delta v_{t,ab}^{1}}\nonumber\\
&\times& \int_{0}^{\infty}\int_{0}^{\infty}f_{a}(x)f_{b}(y)[D_{a}(x)+D_{b}(y)]^{2}xdxdy\label{sn191}\\
\frac{\partial L_{b}}{\partial t}\Bigr|_{col,ab}&=&-\frac{\pi}{4}\bar{E}_{ab}\bar{\Delta v_{t,ab}^{1}}\nonumber\\
&\times&\int_{0}^{\infty}\int_{0}^{\infty}f_{a}(x)f_{b}(y)[D_{a}(x)+D_{b}(y)]^{2}ydxdy\label{sn192}\\
\frac{\partial N_{a}}{\partial t}\bigr|_{col,ab}&=&\frac{\partial N_{b}}{\partial t}\Bigl|_{col,ab}=-\frac{\pi}{4}\bar{E}_{ab}\bar{\Delta v_{t,ab}^{0}}\nonumber\\
&\times&\int_{0}^{\infty}\int_{0}^{\infty}f_{a}(x)f_{b}(y)[D_{a}(x)+D_{b}(y)]^{2}dxdy\label{sn193}\\
\frac{\partial N_{c}}{\partial t}\bigr|_{col,ab}&=&-\frac{\partial N_{a}}{\partial t}\Bigl|_{col,ab}\label{sn194}
\end{eqnarray}

Finally, the equations are transformed by using the approximations as follows,


\begin{eqnarray}
\frac{\partial L_{b}}{\partial t}\Bigr|_{col,ab}&=&-\frac{\pi}{4}\bar{E}_{ab}{N_{a}}{L_{b}}\nonumber\\
&\times&[\delta_{a}^{0}D_{C,a}^{2}(\bar{x}_{a})+\delta_{ab}^{1}D_{C,a}(\bar{x}_{a})D_{C,b}(\bar{x}_{b})+\delta_{b}^{1}D_{C,b}^{2}(\bar{x}_{b})]\label{sn195}\\
&\times&[\theta_{a}^{0}v_{t,a}^{2}(\bar{x}_{a})-\theta_{ab}^{1}v_{t,a}(\bar{x}_{a})v_{t,b}(\bar{x}_{b})+\theta_{b}^{1}v_{t,b}^{2}(\bar{x}_{b})+\sigma_{a}+\sigma_{b}]^{1/2}\nonumber\\
\frac{\partial L_{a}}{\partial t}\Bigr|_{col,ab}&=&-\frac{\pi}{4}\bar{E}_{ab}{N_{b}}{L_{a}}\nonumber\\
&\times&[\delta_{b}^{0}D_{C,b}^{2}(\bar{x}_{b})+\delta_{ab}^{1}D_{C,a}(\bar{x}_{a})D_{C,b}(\bar{x}_{b})+\delta_{a}^{1}D_{C,a}^{2}(\bar{x}_{b})]\label{sn196}\\
&\times&[\theta_{b}^{0}v_{t,b}^{2}(\bar{x}_{b})-\theta_{ba}^{1}v_{t,a}(\bar{x}_{a})v_{t,b}(\bar{x}_{b})+\theta_{a}^{1}v_{t,a}^{2}(\bar{x}_{b})+\sigma_{a}+\sigma_{b}]^{1/2}\nonumber\\
\frac{\partial N_{b}}{\partial t}\Bigr|_{col,ab}&=&-\frac{\pi}{4}\bar{E}_{ab}{N_{a}}{N_{b}}\nonumber\\
&\times&[\delta_{a}^{0}D_{C,a}^{2}(\bar{x}_{a})+\delta_{ab}^{0}D_{C,a}(\bar{x}_{a})D_{C,b}(\bar{x}_{b})+\delta_{b}^{0}D_{C,a}^{2}(\bar{x}_{b})]\label{sn197}\\
&\times&[\theta_{a}^{0}v_{t,a}^{2}(\bar{x}_{a})-\theta_{ab}^{0}v_{t,a}(\bar{x}_{a})v_{t,b}(\bar{x}_{b})+\theta_{b}^{0}v_{t,a}^{2}(\bar{x}_{b})+\sigma_{a}+\sigma_{b}]^{1/2}\nonumber\\
\frac{\partial N_{a}}{\partial t}\Bigr|_{col,ab}&=&-\frac{\pi}{4}\bar{E}_{ab}{N_{a}}{N_{b}}\nonumber\\
&\times&[\delta_{a}^{0}D_{C,a}^{2}(\bar{x}_{a})+\delta_{ab}^{0}D_{C,b}(\bar{x}_{a})D_{C,b}(\bar{x}_{b})+\delta_{b}^{0}D_{C,b}^{2}(\bar{x}_{b})]\label{sn198}\\
&\times&[\theta_{a}^{0}v_{t,a}^{2}(\bar{x}_{a})-\theta_{ba}^{0}v_{t,b}(\bar{x}_{a})v_{t,b}(\bar{x}_{b})+\theta_{b}^{0}v_{t,b}^{2}(\bar{x}_{b})+\sigma_{a}+\sigma_{b}]^{1/2}\nonumber
\end{eqnarray}

\subsubsection{The collision case3: a+a $\rightarrow$ b}
In the case, binary collision between particles in the same hydrometeor is considered. All the pairs in the collision turn into the other hydormeteor as follows,

\begin{eqnarray}
\frac{\partial f_{a}(x)}{\partial t}\Bigr|_{col,aa}=-\int_{0}^{\infty}f_{a}(x)f_{a}(y)K_{aa}(x,y)dy\label{sn199}
\end{eqnarray}

The growth rate of the prognostic moments is as follows,

\begin{eqnarray}
\frac{\partial L_{a}}{\partial t}\Bigr|_{col,aa}&=&-\frac{\pi}{4}\bar{E}_{aa}{N_{a}}{L_{a}}\nonumber\\
&\times&{\delta_{a}^{0}D_{C,a}^{2}(\bar{x}_{a})+\delta_{aa}^{1}D_{C,a}^{2}(\bar{x}_{a})}\nonumber\\
&\times&{\theta_{a}^{0}v_{t,a}^{2}(\bar{x}_{a})-\theta_{aa}^{1}v_{t,a}^{2}(\bar{x}_{a})+2\sigma_{a}}\label{sn200}\\
\frac{\partial N_{a}}{\partial t}\Bigr|_{col,aa}&=&-\frac{\pi}{4}\bar{E}_{aa}{N_{a}}{N_{a}}\nonumber\\
&\times&{2\delta_{a}^{0}D_{C,a}^{2}(\bar{x}_{a})+\delta_{aa}^{0}D_{C,a}^{2}(\bar{x}_{a})}\nonumber\\
&\times&{2\theta_{a}^{0}v_{t,a}^{2}(\bar{x}_{a})-\theta_{aa}^{0}v_{t,a}^{2}(\bar{x}_{a})+2\sigma_{a}}\label{sn201}\\
\frac{\partial L_{b}}{\partial t}\Bigr|_{col,aa}&=&-\frac{\partial L_{a}}{\partial t}\Bigr|_{col,aa}\label{sn202}\\
\frac{\partial N_{b}}{\partial t}\Bigr|_{col,aa}&=&-\frac{1}{2}\frac{\partial N_{a}}{\partial t}\Bigr|_{col,aa}\label{sn203}
\end{eqnarray}


\subsubsection{The collision case 4: a+a $\rightarrow$ a}
In the case, self aggregational growth is considered. In the aggregation, the number concentration of the hydrometeor “a” decreases under the conservation of the mass concentration. The basic equation is the same as the case 3 except for the absence of the other hydrometeor.

\begin{eqnarray}
\frac{\partial N_{a}}{\partial t}&=&-\frac{1}{2}\frac{\pi}{4}\bar{E}_{aa}N_{a}N_{a}\nonumber\\
&\times&{2\delta_{a}^{0}D_{C,a}^{2}(\bar{x}_{a})+\delta_{aa}^{0}D_{C,a}^{2}(\bar{x}_{a})}\nonumber\\
&\times&{2\theta_{a}^{0}v_{t,a}^{2}(\bar{x}_{a})+\theta_{aa}^{0}v_{t,a}^{2}(\bar{x}_{a})+2\sigma_{a}}^{1/2}\label{sn204}
\end{eqnarray}

\subsubsection{The secondary processes}
There are several secondary processes associated with the mixed phase collection. Here, we briefly describe them following Seifert and Beheng (2006a).

\subsubsection{Enhanced melting}
We assume that the particle temperature is the same as the enviromental temperature. However, the melting process allows the existence of ice particles under the warmer condition than the melting point. In the riming process under the condition, coalescence of a liquid droplet uniformizes the temperature of colliding two particles. Subsequently, the temperature difference between a ice particle and a liquid droplet are compensated by the latent heat relase of the ice particle. In our model framework, since the category of wet ice particle is not considered, the melting part of a riming particle is accounted as the production of a liquid droplet. The melting rate by the riming process is formulated following Rutledge and Hobbs (1984),

\begin{eqnarray}
\frac{\partial L_{js}}{\partial t}\Bigr|_{eml}=-\frac{c_{1}T_{c}}{L_{f0}}\frac{\partial L_{js}}{\partial t}\Bigr|_{col}\;\;(T_{c}>0^{o}C),\;(js=i,s,g)\label{sn205}
\end{eqnarray}

Here, the reduction rate of number conentration is treated similarly to the melting process,

\begin{eqnarray}
\frac{\partial N_{js}}{\partial t}\Bigr|_{eml}=\frac{1}{\bar{x}_{js}}\frac{\partial L_{js}}{\partial t}\Bigr|_{col}\label{sn206}
\end{eqnarray}

\subsubsection{Partial convesrion}
According to Seifert and Beheng (2006a), a riming particle becomes a densely rimed spherical particle as soon as the collected liquid droplet fills up the envelop of the collecting ice particle. The produced densely rimed spherical particle is categorized as graupel. Here, we consider that the volume difference between a ice crystal or a spongy ice particle and its enveloping sphere is filled by the collected liquid droplet. The critical liquid droplet mass $\bar{x}_{crit,pcon}$ is estimated by the geometry of ice as follows,

\begin{eqnarray}
\bar{x}_{crit,pcon,js}=\alpha_{fill,js}\rho_{w}\bigl(\frac{\pi}{6}\bar{D}_{js}^{3}-\frac{\bar{x}_{js}}{\rho_{\varepsilon}},\;\;\;(js=i,s)\label{sn207}
\end{eqnarray}

where $\alpha_{fill}$ is the so-called filling coefficient, $\rho_{\varepsilon} = 900 kg m^{-3}$ is density of ice. The filling coefficient is the criterion to categorize a ice particle as graupel by its dense. Tentatively, $\alpha_{fill}$, $i = 0.68$ and $\alpha_{fill}$, $s = 0.01$ are set by Seifert and Beheng (2006a). This means that snow is categorized as almost unrimed ice particles. The characteristic conversion time scale τpcon is estimated by the growth rate of mean particle mass by the riming process as follows,

\begin{eqnarray}
\tau_{pcon,js}=\frac{\bar{x}_{crit,pcon,js}}{\frac{1}{N_{js}}\frac{\partial L_{js}}{\partial t}\Bigr|_{rime}}\label{sn208}
\end{eqnarray}

Finally, the conversion rates of riming particles into graupel are derived by using the characteristic time scale.

\begin{eqnarray}
\frac{\partial L_{g}}{\partial t}\Bigr|_{pcon}&=&\frac{L_{js}}{\tau_{pcon,js}}=min\bigl(\frac{\bar{x}_{js}}{\bar{x}_{crit,pcon,js}},1\bigr)\frac{\partial L_{js}}{\partial t}\Bigr|_{rime}\label{sn209}\\
\frac{\bar{x}_{js}}{\bar{x}_{crit,pcon,js}}&=&\Bigl[\alpha_{fill,js}\frac{\rho_{w}}{\rho_{\varepsilon}}\bigl(\frac{\pi}{6}D_{i}^{3}\rho_{i}\frac{1}{\bar{x_{js}}}-1\bigr)\Bigr]^{-1}\label{sn210}
\end{eqnarray}

The conversion rate of number concentration is as follows,

\begin{eqnarray}
\frac{\partial N_{g}}{\partial t}\Bigr|_{pcon}=\frac{1}{\bar{x}_{js}}\frac{\partial L_{g}}{\partial t}\Bigr|_{pcon}
\end{eqnarray}

The conversion coefficient of riming particle $\bar{x}/\bar{x}_{crit,pconv}$ is shown in Fig.\ref{figsn2-23}. In this formulation, small ice particles are likely to convert into graupel in riming because small ice particles have simple geometry and are almost sphere. In order to suppress the conversion of small ice particles, partial conversion are limited to ice particles with the mean diameter of more than 500 $\mu m$.

\subsubsection{Ice multiplication}
It has been observed that the number concentration of ice particles can be up to several orders of magnitude larger than ice nuclei in atmospheric cloud (Pruppacher and Klett, 1997). Among the possible mechanisms to explain the fact, the Hallet-Mossop mechanism has been received in many literatures and widely applied in cloud microphysics schemes. The Hallet-Mossop mechanism is based on the fact that ice splintering occurs when many liquid droplets are collected by graupel. Cotton et al. (1986) applied the formulations based on the observations by Hallet and Mossop (1974), and Mossop (1976). 
Hallet and Mossop (1974) reported that approximately 350 ice splinters were produced for every $10^{-3} g$ of rime accreted by a graupel at -5 degC. The parameterization is formulated with the temperature correction f1 in the units of mks as follows,

\begin{eqnarray}
\frac{\partial N_{i}}{\partial t}\Bigr|_{spl1,js}&=&350\times 10^{6}\times f_{1}(T)\times\frac{\partial L_{js}}{\partial t}\Bigr|_{rime,js},\;\;(js=i,s,g)\label{sn212}\\
f_{1}(T)&=&
\left\{
\begin{array}{l}
0,\;\;(T><270.16K) \\
\frac{T-268.16}{3},\;\;(270.16K \geq T \geq 268.16K) \\
\frac{T-268.16}{3},\;\;(268.16K > T \geq 265.16K) \\
0,\;\;(265.16K>T)
\label{sn213}
\end{array}
\right.
\end{eqnarray}

The splintering mass concentration is assumed as follows

\begin{eqnarray}
\frac{\partial L_{i}}{\partial t}\Bigr|_{spl1}=\bar{x}_{i}\frac{\partial N_{i}}{\partial t}\Bigr|_{spl1}\label{sn214}
\end{eqnarray}

On the other hand, Mossop (1976) reported that approximately one ice crystal was produced per 250 drops larger than 12 $\mu m$ radius accreted onto a graupel at -5 degC. Here, since it is difficult to calculate the number concentration of riming cloud droplets larger than 12 $\mu m$ ($N_{rime,c}$), we assume simple relationship following Cotton et al. (1986) as follows,

\begin{eqnarray}
\frac{N_{rime,c}}{N_{rime,c}}\approx\frac{N_{c}}{N_{c}}=Q\bigl(\frac{\nu_{c}+1}{\mu_{c}},x_{12}\bigr)\label{sn215}
\end{eqnarray}

where Q is the complement of the incomplete gamma function, and $x_{12}$ is the droplet mass with the radius of $12 \mu m$. With the above relation, the parameterization is formulated with the same temperature correction function in the units of mks as follows,

\begin{eqnarray}
\frac{\partial N_{i}}{\partial t}\Bigr|_{spl2,js}=\frac{1}{250}\times f_{1}\times Q\times\bigl(\frac{N_{c}}{L_{c}}\frac{\partial L_{js}}{\partial t}\Bigr|_{rime,js}\bigr),\;\;(js=i,s,g)\label{sn216}
\end{eqnarray}

In contrast to Cotton et al. (1986), we evaluate the incomplete gamma function with an accurate approximation by Press et al. (2007). The splintering rates of mass concentration is assumed as follows,

\begin{eqnarray}
\frac{\partial L_{i}}{\partial t}\Bigr|_{spl2} = \bar{x_{i}}\frac{\partial N_{i}}{\partial t}\Bigr|_{spl2}\label{sn217}
\end{eqnarray}

Here, it should be noticed that we may double count the ice multiplication process due to the Hallet-Mossop mechanism by using the two formulations. Those two formulations may be two independent processes or the interpretations of the same process in different two development stages. Since the process is poorly understood by the lack of observation, the assessment of the process by a set of sensitivity studies is necessary in the future.

\begin{figure}[]
\begin{center}
\includegraphics[scale=0.75]{./figure/mod_gamma_dist.eps}
\end{center}
\caption{Left figure shows the modified Gamma distribution for various shape parameters μm. Center figure shows the scatter plot of shape parameter and mean volume diameter for various initial conditions. Gray dots are from cloud model, dotted line is parameterization of Milbrandt and Yau (2005) and dashed-dotted line is that of Seifert (2008). Right figure shows the scatter plot of evaporation parameter and shape parameter. These are from Seifert (2008).}
\label{figsn2-17}
\end{figure}

\begin{figure}[]
\begin{center}
\includegraphics[scale=0.5]{./figure/density_max_num.eps}
\end{center}
\caption{Dependency of maximum number concentration on updraft velocity in ascending air parcel. These are based on a Twomey equation with various CCN conditions. Aerosol activation spectrum refers to eq.\ref{sn107}.}
\label{figsn2-18}
\end{figure}

\begin{figure}[]
\begin{center}
\includegraphics[scale=0.5]{./figure/cond_timescale.eps}
\end{center}
\caption{Timescale of condensation for cloud droplets at maximum number concentration in ascending air parcel. Experimental design is the same as Fig.\ref{figsn2-18}.}
\label{figsn2-19}
\end{figure}

\begin{figure}[]
\begin{center}
\includegraphics[scale=0.5]{./figure/homo_frz_rate.eps}
\end{center}
\caption{The dependencies of the homogeneous freezing rate (dashed line) and the heterogeneous freezing rate (solid line) on centigrade temperature. The freezing rates are in common logarithmic scale.}
\label{figsn2-20}
\end{figure}

\begin{figure}[]
\begin{center}
\includegraphics[scale=0.25]{./figure/univ_function.eps}
\end{center}
\caption{The universal functions of (a) auto-conversion and (b) accretion as a function of the dimensionless internal time scale.}
\label{figsn2-21}
\end{figure}

\begin{figure}[]
\begin{center}
\includegraphics[scale=0.25]{./figure/stic_effic.eps}
\end{center}
\caption{The dependency of stick efficiencies on centigrade temperature. The stick efficiencies by (a) the various observations from Pruppacher and Klett (1997) and (b) model parameterizations.}
\label{figsn2-22}
\end{figure}

\begin{figure}[]
\begin{center}
\includegraphics[scale=0.5]{./figure/partial_conversion_coef.eps}
\end{center}
\caption{The coefficients of partial conversion. Solid line shows the coefficient of ice, and the line with symbol shows the coefficient of snow.}
\label{figsn2-23}
\end{figure}

\subsubsection{Appendix of Seiki and Nakajima (2014)}
\subsubsection{The k-th moment of generalized Gamma distribution}
The kth moment of the DSD frequently appear in the equations of cloud microphysics. In this section, derivation of the kth moment of the generalized Gamma distribution is described. The generalized Gamma distribution is defined as $f(x) = \alpha x \nu exp(-\lambda x \mu)$. There are four parameters in this generalized Gamma distribution but only two prognostic moments in a CRM; the number concentration N and mass concentration L. Hence $\mu$ and $\nu$ are set constant parameters so that the other coefficients $\alpha$ and $\lambda$ can be related to N and L as follows.

\begin{eqnarray}
M^{0}=N&=&\alpha\int_{0}^{\infty}x^{\nu}exp(\lambda x^{\mu})dx\nonumber\\
&=&\frac{\alpha}{\lambda^{(\nu+1)/\mu}\mu}\int_{0}^{\infty}y^{(\nu+1)/\mu-1}exp(-y)dy,\;(y\equiv\lambda x^{\mu})\nonumber\\
&=&\frac{\alpha}{\lambda^{(\nu+2)/\mu}\mu}\Gamma\bigl(\frac{\nu+1}{\mu}\bigr)\label{sn255}\\
M^{1}=L&=&\frac{\alpha}{\lambda^{(\nu+2)/\mu}\mu}\Gamma\bigl(\frac{\nu+1}{\mu}\bigr)\nonumber
\end{eqnarray}

Then $\alpha$ is expressed as, 

\begin{eqnarray}
\alpha=\frac{N\mu\lambda^{(\nu+1)/\mu}}{\Gamma\bigl(\frac{\nu+1}{\mu}\bigr)}=\frac{L\mu \lambda^{(\nu+2)/\mu}}{\Gamma\bigl(\frac{\nu+2}{\mu}\bigr)}\nonumber
\end{eqnarray}

and then we can derivev $\lambda$ and $\alpha$,

\begin{eqnarray}
\lambda=\Bigl[\frac{\Gamma\bigl(\frac{\nu+1}{\mu}\bigr)}{\Gamma\bigl(\frac{\nu+2}{\mu}\bigr)}\Bigr]^{-\mu}\bar{x}^{-\mu}\;\;and\;\;\alpha=\frac{\nu N}{\Gamma\bigl(\frac{\nu+1}{\mu}\bigr)}\lambda^{(\nu+1)/\mu}\label{sn256}
\end{eqnarray}

where $\bar{x}=L/N$ define the mean particle mass. Here we can rewrite the generalized Gamma distribution by using N and L in following form,

\begin{eqnarray}
f(x)=\frac{N}{\bar{x}}\bigl(\frac{x}{\bar{x}}\bigr)^{\nu}\frac{\mu}{\Gamma\bigl(\frac{nu+1}{\mu}\bigr)}\Bigl[\frac{\Gamma\bigl(\frac{\nu+2}{\mu}\bigr)}{\Gamma\bigl(\frac{\nu+1}{\mu}\bigr)}\Bigr]^{\nu+1}\exp\Bigl[-\bigl[\frac{\Gamma((\nu+2)/\mu)}{\Gamma((\nu+1)/\mu)}\frac{x}{\bar{x}}\bigr]^{\mu}\Bigr]\label{sn257}
\end{eqnarray}

The kth moment of DSD is now given by the expansion of eq.\ref{sn255} and by using eq.\ref{sn256},

\begin{eqnarray}
M^{k}=\frac{\Gamma\bigl(\frac{k+\nu+1}{\mu}\bigr)}{\Gamma\bigl(\frac{\nu+1}{\mu}\bigr)}\Bigl[\frac{\Gamma\bigl(\frac{\nu+1}{\mu}\bigr)}{\Gamma\bigl(\frac{\nu+2}{\mu}\bigr)}\Bigr]^{k}N\bar{x}^{k},\;\;(k\in R)
\end{eqnarray}


\subsection{Spectral Bin Model(SBM)\cite{suzuki_etal_2010}}
The Spectral Bin Model (SBM) was developed by Suzuki et al. (2010)\cite{suzuki_etal_2010}. The model forecasts Size Distribution Function(SDF) of 7 types hydrometeors (liquid, plate-ice, columner-ice, dendrite-ice, snow, graupel, and hail). \\
The SBM calculates mass density of the 7 types of hydrometeor and 1 type of aerosol as their SDFs. The SDF of aerosol can be changed by advection and acvitvaiton (i.e. nucleation from aerosol to cloud) process. The SDF of hydrometeors can be changed by several growth processes (i.e. activation from aerosol to cloud, condensation/evaporation, collision/coaguration, freezing/melting, ice nucleation, riming, aggregation, advection, and gravitational falling). \\
The time evolution of SDF (number density) of aerosol ($f_{a}(m,t)$) and SDF (number density) of hydrometeor ($f_{c}(m,t)$) are shown as equations:

\begin{eqnarray}
\frac{\partial f^{(\mu)}_{c}(m,t)}{\partial t}&=&Adv\bigl[f^{(\mu)}_{c}(m,t)\bigr]+Grav\bigl[f^{(\mu)}_{c}(m,t)\bigr]+\Bigl[ \frac{\partial f^{(\mu)}_{c}(m,t)}{\partial t}\Bigr ]_{cloud\;microphysics}\label{s10-1}\\
\frac{\partial f_{a}(m_{a},t)}{\partial t}&=&Adv\bigl[f_{a}(m_{a},t)\bigr]+Grav\bigl[f_{a}(m_{a},t)\bigr]+\Bigl[ \frac{\partial f_{a}(m_{a},t)}{\partial t} \Bigr ]_{cloud\;microphysics}.\label{s10-2}
\end{eqnarray}

where $\mu$ shows type of hydrometeor (the 7 types), $Adv[]$, $Grav[])$ shows change of SDF by the advection and the gravitational falling. $\Bigl[ \Bigr]_{cloud\;microphycis}$ shows changes of SDF by the cloud microphysical processes.\\
The time evolution of $f_{c}^{(\mu)}(m,t)$ and $f_{a}(m,t)$ are shown as:

\begin{eqnarray}
\Bigl[ \frac{\partial f_{c}^{(\mu)}(m,t)}{\partial t}\Bigl]_{cloud\;microphysics}&=&\Bigl[\frac{\partial f_{c}^{(\mu)}(m,t)}{\partial t}\Bigr]_{activation}+\Bigl[\frac{\partial f_{c}^{(\mu)}(m,t)}{\partial t}\Bigr]_{cond/evap}\nonumber\\
&+&\Bigl[\frac{\partial f_{c}^{(\mu)}(m,t)}{\partial t}\Bigr]_{coll/coag/rim/agg}\nonumber\\
&+&\Bigl[\frac{\partial f_{c}^{(\mu)}(m,t)}{\partial t}\Bigr]_{frz}+\Bigl[\frac{\partial f_{c}^{(\mu)}(m,t)}{\partial t}\Bigr]_{melt}\nonumber\\
\Bigl[ \frac{\partial f_{a}(m_{a},t)}{\partial t}\Bigl]_{cloud\;microphysics}&=&\Bigl[\frac{\partial f_{a}(m_{a},t)}{\partial t}\Bigr]_{activation}\nonumber
\end{eqnarray}

where $\Bigl[\;\Bigr]_{***}$ show change of SDF by each cloud growth processes. The detail of these processes will be shown later.\\
 The change of SDFs by advection and gravitational falling (i.e. first and second term of eq. \ref{s10-1}, and \ref{s10-2}  ) are calculated by dynamical core of SCALE-LES3 shown in section 3.


\subsubsection{Discretization of Size Distribution Function(SDF)}
The SDF of aerosol and cloud is predict as mass density of each particle size ($g_{a}(m_{a})$, $g_{c}^{(\mu)}(m)$). However most of equations are given as equations of number density of cloud/aerosol ($f_{c}^{(\mu)}(m,t)$, $f_{a}(m_{a},t)$), the mass density of cloud/aerosol are transferred to number density of cloud/aerosol ($g_{a}(m_{a},t)=m_{a}g_{a}(m_{a},t)$, $g_{c}^{(\mu)}(m,t)=m^{(\mu)}f_{c}^{(\mu)}(m,t)$).\\
To cover wide size range (i.e. $2\;\mu m$ $\sim$ $3\;mm$), logarithmically uniform grid system ($log(m)\equiv \eta$, $log(m_{a})\equiv \eta_{a}$) is used. In this system, the relationship, $\frac{m_{i+1}}{m_{i}}=const.$ is satisfied.

\subsubsection{Activation from aerosol to cloud particles (Nucleation process)}
The change of SDFs by activation from aerosol to cloud particles are calculated based on Kohler theory (Kohler 1936). Through this process, aerosols whose radii are larger than critical radius of aerosol ($r_{a,crit}$) are activated to clouds. The critical radius is given as

\begin{eqnarray}
r_{a,crit}=\bigl( \frac{4}{27}\frac{A^{3}}{B}\frac{1}{S_{w}}\Bigr )^{1/3}, \:\:\:A=\frac{2\sigma}{R_{v}\rho_{L}T},\:\:\: B=i_{v}\frac{M_{v}}{M_{s}}\frac{\rho_{s}}{\rho_{L}}.\label{s10-3}
\end{eqnarray}

where $S_{w}$, $\sigma$, $R_{v}$, $\rho_{L}$, $T$, $i_{v}$, $M_{v}$, $M_{s}$, $\rho_{s}$ show supersaturation of water, surface tention of water, gas constant of vapor, temperature, van't Hoff factor ($=2$), moleculer weight of water, moleculer weight of aerosol, and density of aerosol, respectively.\\
At each time step, $r_{a,crit}$ are calculated by using temperature, and mass of aerosols whose radii are larger than $r_{a,crit}$ remove from SDF of aerosol and they are transferred to SDF of cloud as newly generated cloud particles.\\
The radii of newly generated clouds are corresponding to those of aerosols, but if the radii of aeorol are smaller than the lower limit of cloud SDF, the radii of newly generated clouds are set to smallest size of cloud SDF ($\sim 2 \mu m$).\\
The change of aerosol's SDF and hydrometeor's SDF are shown as:

\begin{eqnarray}
\Bigl[\frac{\partial f_{a}}{\partial t}\Bigr]_{activation}&=&-\int_{m_{a,crit}}^{\infty}f_{a}(m_{a},t)dm_{a}\label{s10-4}\\
\Bigl[\frac{\partial f_{c}^{(\mu)}}{\partial t}\Bigr]_{activation}&=&-\Bigl[\frac{\partial f_{a}}{\partial t}\Bigr]_{activarion}\label{s10-5}
\end{eqnarray}

where $m_{a,crit}=\bigl(=\frac{4\pi}{3}r_{a}^{3}\rho_{a}$ is mass of aerosol particles whose radii are the same as critical radii, $r_{a,crit}$. When there are not enough vapor to activate all aerosol particles whose radii are larger than the critical radius, i.e.

\begin{eqnarray}
\int_{m_{a,crit}}^{\infty}m_{a}f_{a}(m_{a},t)dm_{a} > q_{v}\rho,\label{s10-6}
\end{eqnarray}

only the aerosol particles whose radii are larger than $r_{a0,crit}$, which are given as:

\begin{eqnarray}
\int_{m_{a0,crit}}^{\infty}m_{a}f_{a}(m_{a},t)dm_{a} = q_{v}\rho,\label{s10-7}
\end{eqnarray}


are transferred to cloud paricles as:

\begin{eqnarray}
\Bigl[\frac{\partial f_{a}}{\partial t}\Bigr]_{activation}&=&-\int_{m_{a0,crit}}^{\infty}f_{a}(m_{a},t)dm_{a},\label{s10-8}\\
\Bigl[\frac{\partial f_{c}^{(\mu)}}{\partial t}\Bigr]_{activation}&=&-\Bigl[\frac{\partial f_{a}}{\partial t}\Bigr]_{activarion}.\label{s10-9}
\end{eqnarray}

where $q_{v}$ and $\rho$ is mixing ratio of water vapor and density.

\subsubsection{Condensation/Evaporation}
Calculation of condensation and evaporation process are based on a equation. The mass change by these two process are given by an equation (e.g. Rogers and Yau, 1989\cite{ry_1989}):

\begin{eqnarray}
\frac{dm}{dt}&=&C^{(\mu)}(m)G^{(\mu)}(T)S^{(\mu)}\\
G^{(\mu)}(T)&=&
\left\{
\begin{array}{l}
G_{w}(T)\;\;\;(\mu : \:liquid)\\
G_{i}(T)\;\;\;(\mu : \:ice)
\end{array}\right. \nonumber\\
G_{w}(T)&=&\frac{4\pi}{\frac{R_{v}T}{e_{w}(T)D_{v}}+\frac{L_{w}}{KT}\bigl( \frac{L_{w}}{R_{v}T}-1\Bigr )}\nonumber\\
G_{i}(T)&=&\frac{4\pi}{\frac{R_{v}T}{e_{i}(T)D_{v}}+\frac{L_{i}}{KT}\bigl( \frac{L_{i}}{R_{v}T}-1\Bigr )}\nonumber\\
S^{(\mu)}&=&
\left\{
\begin{array}{l}
S_{w}\;\;\;(\mu : liquid)\\
S_{i}\;\;\;(\mu : ice)
\end{array}\right.\nonumber
\end{eqnarray}

where $C^{(\mu)}(m)$ is capasitance, which depends on shape of each types of hydrometeor, $S_{w}$, $S_{i}$ are super saturation of water and ice, $L_{w}$, $L_{i}$ is sensible heat of evaporation, sublimation, $D_{v}$ is diffusion constant of vapor, $K$ is conductivity of air, and $e_{w}$, $e_{i}$ is saturation vapor pressure and saturation ice pressure, respectively. Condensation (evaporation) occur when $S^{(\mu)}$ is positive (negative).\\
To calculate change of SDF by condensation/evaporation, mass flux ($F^{(\mu)}_{cond/evap}$) on each bin is given by using number density ($f_{c}^{(\mu)}$) and $\frac{dm}{dt}$ as:

\begin{eqnarray}
F^{(\mu)}_{cond/evap}=f^{(\mu)}(m)\frac{dm}{dt}=f^{(\mu)}(m)C^{(\mu)}G^{(\mu)}(T)S^{(\mu)}.\label{s10-10}
\end{eqnarray}

Using this equation, time evolution of SDF ($f^{(\mu)}$) is given as

\begin{eqnarray}
\Bigl[\frac{\partial f^{(\mu)}(m,t)}{\partial t}\Bigr]_{cond/evap}&=&-\frac{\partial}{\partial m}F^{(\mu)}_{cond/evap}(m)\nonumber\\
&=&-\frac{\partial}{\partial m}\bigl (f^{(\mu)}(m)C^{(\mu)}\bigr ) G^{(\mu)}(T)S^{(\mu)}.\label{s10-11}
\end{eqnarray}


By using the $\eta(=\log(m))$, the eq.\ref{s10-11} is transferred to advection equation :

\begin{eqnarray}
\frac{\partial f^{(\mu)}(\eta)}{\partial t}&=&-\frac{\partial}{\partial \eta}\bigl ( f^{(\mu)}(\eta)U^{(\mu)}(\eta)\bigr)\label{s10-12}\\
U^{(\mu)}(\eta)&=&\frac{C^{(\mu)}(\eta)}{\exp (\eta)}G^{(\eta)}(T)S^{(\eta)}.\nonumber
\end{eqnarray}

To solve the eq. \ref{s10-12}, a scheme developed by Bott (1989)\cite{bott_1989} is used. The number density of i-th bin after $\Delta t$ ($f_{i}(t+\Delta t)$) is given as follow:

\begin{eqnarray}
f_{i}(t+\Delta t)&=&f_{i}(t)-\frac{\Delta t}{\Delta \eta}\bigl [F_{cond/evap,i+1/2}-F_{cond/evap,i-1/2}\Bigr ].\nonumber\\
F_{cond/evap,i+1/2}&=&\frac{\Delta \eta}{\Delta t}\Bigl[ \frac{i^{+}_{l,i+1/2}}{i_{l,j}}f_{i}(t)-\frac{i^{-}_{l,i+1/2}}{i_{l,i+1}}f_{i+1}(t)\Bigr ]\nonumber\\
i^{+}_{l,i+1/2}&=&max\bigl(0,I^{+}_{l}(c_{i+1/2})\bigr)\nonumber\\
i^{-}_{l,i+1/2}&=&max\bigl(0,I^{-}_{l}(c_{i+1/2})\bigr)\nonumber\\
i^{+}_{l,i}&=&max\bigl(I_{l,i},i^{+}_{l,i+1/2}+i^{-}_{l,i+1/2})\bigr)\nonumber\\
I^{+}_{l}(c_{i+1/2})&=&\sum_{k=0}^{2}\frac{a_{i,k}}{(k+1)2^{k+1}}\bigl[1-(1-2c^{+}_{j})^{k+1}\bigr]\nonumber\\
I^{-}_{l}(c_{i+1/2})&=&\sum_{k=0}^{2}\frac{a_{i+1,k}}{(k+1)2^{k+1}}(-1)^{k}\bigl[1-(1-2c^{-}_{j})^{k+1}\bigr]\nonumber\\
a_{i,0}&=&-\frac{1}{24}\bigl( f_{i+1}(t)-26f_{i}(t)+f_{i-1}(t) \bigr)\nonumber\\
a_{i,1}&=&\frac{1}{2}\bigl( f_{i+1}(t)-f_{i-1}(t) \bigr)\nonumber\\
a_{i,2}&=&\frac{1}{2}\bigl( f_{i+1}(t)-2f_{i}(t)+f_{i-1}(t) \bigr)\nonumber\\
c_{i}^{\pm}&=&\pm\bigl( c^{n}_{i+1/2}\pm | c^{n}_{i+1/2}|\bigr )/2\nonumber\\
c^{n}_{i+1/2}&=&U^{n}_{i+1/2}\frac{\Delta t}{\Delta \eta}\label{s10-12}
\end{eqnarray}

Since the super saturation ($S^{(\mu)}$) can change during time step ($\Delta t$), we apply a method shown below to reflect the change of supersaturation during $\Delta t$.\\
Time evolution of supersaturation can be given by equations:

\begin{eqnarray}
\frac{d}{dt}\left(
\begin{array}{l}
S_{w}\\
S_{i}\\
\end{array}\right )
&=&
\left(
\begin{array}{cc}
a_{c/e}& b_{c/e}\\
c_{c/e}& d_{c/e}
\end{array}\right)
\left(
\begin{array}{l}
S_{w}\\
S_{i}
\end{array}\right)
=
A
\left(
\begin{array}{l}
S_{w}\\
S_{i}
\end{array}\right)\label{s10-13}\\
a_{c/e}&=&-(S_{w}+1)\Bigl(\frac{1}{q_{v}}+\frac{L_{w}}{R_{v}T^{2}}\frac{L_{w}}{C_{p}}\Bigr )\int f^{(w)}(m)C^{(w)}(m)dm G_{w}(t)\nonumber\\
b_{c/e}&=&-(S_{w}+1)\Bigl(\frac{1}{q_{v}}+\frac{L_{w}}{R_{v}T^{2}}\frac{L_{i}}{C_{p}}\Bigr ) \sum_{\mu \in ice}\int f^{(\mu)}(m)C^{(\mu)}(m)dm G_{i}(t)\nonumber\\
c_{c/e}&=&-(S_{i}+1)\Bigl(\frac{1}{q_{v}}+\frac{L_{i}}{R_{v}T^{2}}\frac{L_{w}}{C_{p}}\Bigr ) \int f^{(w)}(m)C^{(w)}(m)dm G_{w}(t)\nonumber\\
d_{c/e}&=&-(S_{i}+1)\Bigl(\frac{1}{q_{v}}+\frac{L_{i}}{R_{v}T^{2}}\frac{L_{i}}{C_{p}}\Bigr ) \sum_{\mu \in ice}\int f^{(\mu)}(m)C^{(^mu)}(m)dm G_{i}(t)\nonumber
\end{eqnarray}


where $q_{v}$ is mixing ration of vapor. \\
Using eigen value of $A$ ($\Lambda_{+}$, $\Lambda_{-}$ ($\Lambda_{+}>\Lambda_{-})$), and assuming $a_{c/e}$, $b_{c/e}$, $c_{c/e}$, $d_{c/e}$ is constant during $\Delta t$, average value of super saturation ($\bar{S}_{w,i}(t)$) during $\Delta t$ is given as:

\begin{eqnarray}
\bar{S}_{w}(t)=\frac{1}{\Delta t}\int_{t}^{t+\Delta t}S_{w}(\tau)d\tau&=&b\frac{e^{\Lambda_{+}\Delta t}-1}{\Lambda_{+}\Delta t}S_{+}(t)+b\frac{e^{\Lambda_{-}\Delta t}-1}{\Lambda_{-}\Delta t}S_{-}(t)\nonumber\\
\bar{S}_{i}(t)=\frac{1}{\Delta t}\int_{t}^{t+\Delta t}S_{i}(\tau)d\tau&=&(\Lambda_{+}-a)\frac{e^{\Lambda_{+}\Delta t}-1}{\Lambda_{+}\Delta t}S_{+}(t)+(\Lambda_{-}-a)\frac{e^{\Lambda_{-}\Delta t}-1}{\Lambda_{-}\Delta t}S_{-}(t)\nonumber\\
S_{+}(t)&=&\frac{(\Lambda_{-}-a)S_{w}(t)-bS_{i}(t)}{b(\Lambda_{-}-\Lambda_{+})}\nonumber\\
S_{+}(t)&=&\frac{(a-\Lambda_{+})S_{w}(t)+bS_{i}(t)}{b(\Lambda_{-}-\Lambda_{+})}\nonumber
\end{eqnarray}

The averaged super saturation ($\bar{S}_{w,i}(t)$) is used to solve the eq. \ref{s10-13}.

\subsubsection{Collision/Coagulation/Riming/Aggregation}
Collision/Coagulation process are calculated by solving Stochastic Collision Equation (e.g. Pruppecher and Klett, 1997)\cite{pk_1997}:

\begin{eqnarray}
\frac{\partial f(m)}{\partial t}&=&\int_0^{m/2}f(m')f(m-m')K(m',m-m')dm' \nonumber\\
&-&f(m)\int_0^{\infty}f(m'')K(m,m'')dm''\label{s10-14}
\end{eqnarray}

where $K(m,m')$ is collection kernel function. Three types of the kernel function, i.e. Long type kernel (Long, 1974\cite{long_1974}), Golovin type kernel (Golovin, 1963\cite{golovin_1963}) and Hydro-dynamic dynamic kernel as shown eq. \ref{s10-15} are implemented into the SCALE-LES3.

\begin{eqnarray}
K(m,m')=\pi(r(m)-r(m'))\left| V(m)-V(m')\right |E_{col}(m,m')E_{coag}(m,m')\label{s10-15}
\end{eqnarray}

where $r(m)$ is radius of hydrometeros whose mass is $m$, and $V(m)$ is terminal velocity of hydrometeors. The terminal velocity of each species of hydrometeor and each size are shown in Figure \ref{figs10-term} $E_{col}$, and $E_{coag}$ is collision effieiency and coagulation efficiansy, respectively.\\

\begin{figure}[h]
\begin{center}
\includegraphics[scale=0.9]{./figure/terminal-velocity.eps}
\end{center}
\caption{Terminal velocity of Water (Plus), Plate-type ice (Cross), Columnar-type ice (Asterisk), Dendrite-type ice(Open square), Snow(Closed square), Graupel(Open circle), and Hail(Closed circle)}
\label{figs10-term}
\end{figure}


Although the stochastic collision equation can be apply for collision/coagulation of one type of hydrometeros (i.e. liquid water), the SCALE-LES3 predicts 7 types of hydrometeors, and interactions of these types hydrometeors (i.e. riming/aggregation) must be calculated. To calculate the interaction of all 7 types of hydrometeors, the extented stochastic collision equation:

\begin{eqnarray}
\Bigr[\frac{\partial f^{(\mu)}(m)}{\partial t}\Bigr]_{coll/coag/rim/agg}&=&\nonumber\\
\sum_{\lambda}\sum_{\nu}\int_{0}^{m/2}f^{(\lambda)}&(&m')f^{(\nu)}(m-m')K_{\lambda\nu}(m',m-m')dm' \nonumber\\
-f^{(\mu)}(m)\sum_{\kappa}\int_0^{\infty}f^{(\kappa)}&(&m'')K_{\kappa\mu}(m,m'')dm''\label{s10-16}
\end{eqnarray}

is applied (where $\mu$, $\nu$, $\lambda$, $\kappa$ represent species of hydrometeor). The convinations of $\mu$, $\nu$, $\lambda$ are shown in table \ref{table-s10-1}.

\begin{table}[h]
\begin{center}
\caption{Catalog of interaction between 7 species. W, I, S, G, H shows water, ice, snow, graupel, and hail, respectively. G/H shows graupel(hail) generates when T is lower(higher) than 270.15}
\label{table-s10-1}
\begin{tabular}{cccccc}
\hline
     & W   & I   & S   & G   & H   \\ \hline\hline
W    & W   & G/H & G/H & G/H & G/H \\ \hline
I    & I   & S   & S   & I   & I   \\ \hline
S    & S   & S   & S   & S   & S   \\ \hline
G    & G/H & G/H & G   & G   & G/H \\ \hline
H    & G/H & G/H & G/H & G/H & H   \\ \hline
\end{tabular}
\end{center}
\end{table}


To solve the stochastic collision equation, a scheme developed by Bott (1998)\cite{bott_1998} was implemented into SCLAE-LES3.\\
The Bott (1998)\cite{bott_1998} scheme calculate evolution of mass density distribution ($g(\eta)=mf(\eta)$, $\eta=\log(m)$). The stochastic collision equation can be transferred to

\begin{eqnarray}
\frac{\partial g(\eta)}{\partial t}&=&\int_{\eta_{0}}^{\eta_{1}}\frac{m^{2}}{(m-m')^{2} m'}g(\eta-\eta') K(\eta-\eta',\eta')g(\eta')d\eta' \nonumber\\
&-&\int_{\eta_{0}}^{\infty} g(\eta)\frac{K(\eta,\eta')}{m'}g(\eta')d\eta'.\label{s10-17}
\end{eqnarray}

 where $\eta_{1}=\log(m/2)$. Decreases of mass of i-th bin and j-th bin are given by

\begin{eqnarray}
\frac{\partial g_{i}^{(\mu)}}{\partial t}=-\Delta g^{(\mu)}_{i} K_{\mu\nu}(i,j)\frac{g_{j}^{(\nu)}}{m_{j}}\Delta \eta\label{s10-18}
\end{eqnarray}

and


\begin{eqnarray}
\frac{\partial g_{j}^{(\mu)}}{\partial t}=-\Delta g^{(\nu)}_{j}K_{\mu\nu}(i,j)\frac{g_{i}^{(\mu)}}{m_{i}}\Delta \eta\label{s10-19}
\end{eqnarray}

respectively. The terms corresponds to the second term of right-hand side of eq.\ref{s10-17}. The eq. \ref{s10-18} and eq. \ref{s10-19} can transfer to

\begin{eqnarray}
\Delta g_{i}^{(\mu)}=g_{i}^{(\mu)}\Bigl [1-\exp\bigl(-K_{\mu\nu}(i,j)\frac{g^{(\nu)}_{j}}{m_{j}}\Delta \eta\Delta t\bigr) \Bigl]\label{s10-20}\\
\Delta g_{j}^{(\nu)}=g_{j}^{(\nu)}\Bigl [1-\exp\bigl(-K_{\mu\nu}(i,j)\frac{g^{(\mu)}_{i}}{m_{i}}\Delta \eta\Delta t\bigr) \Bigl].\label{s10-21}
\end{eqnarray}

The sum of $\Delta g_{i}^{(\mu)}$ and $\Delta g_{j}^{(\nu)}$ corresponds to newley generated mass by collision of hydrometeor whose mass is $m_{i}$ and $m_{j}$. The newly generated mass ($g'=\Delta g_{i}^{(\mu)}+\Delta g_{j}^{(\nu)}$, which is coresponding to first term of right-hand side of eq.\ref{s10-17}) added k-th bin ($m_{k}=m_{i}+m_{j}$). Since $m_{k}$ is not always bin center, newly generated mass is devided to k-th and k+1-th bin as follow.\\
The production of k-th and k+1-th bin is represened:

\begin{eqnarray}
\Delta g_{k}^{(\lambda)}&=&g_{k}^{\lambda}+g'-\zeta\label{s10-22}\\
\Delta g_{k+1}^{(\lambda)}&=&g_{k+1}^{\lambda}+\zeta\label{s10-23}\\
\zeta&=&\frac{g'}{g_{k}^{(\lambda)}+g'}\sum_{s=0}^{2}\frac{a_{k,s}}{(s+1)2^{k+1}}[1-(1-2c_{k})^{k+1}]\nonumber\\
c_{k}&=&\frac{m'-m_{k}}{m_{k+1}-m_{k}}\nonumber\\
a_{k,0}&=&-\frac{1}{24}(g_{k+1}^{(\lambda)}-26g_{k}^{(\lambda)}+g_{k-1}^{(\lambda)})\nonumber\\
a_{k,1}&=&-\frac{1}{2}(g_{k+1}^{(\lambda)}-g_{k-1}^{(\lambda)})\nonumber\\
a_{k,2}&=&-\frac{1}{2}(g_{k+1}^{(\lambda)}-2g_{k}^{(\lambda)}+g_{k-1}^{(\lambda)})\nonumber
\end{eqnarray}

These procedure is applied for all bin of all types of hydrometeors.\\
In addition, to calculate this process fastly, a scheme of Sato et al. (2009)\cite{sato_etal_2009} are also implemented into SCALE-LES3.

\subsubsection{Freezing}
The calculation of freezing process is based on a parameterization of Bigg (1953)\cite{bigg_1953}. The parameterization is calculated number density of water ($f_{c}^{(w)}$), wchich can be freezed:

\begin{eqnarray}
\frac{\partial}{\partial t}f^{(w)}(m)&=&-\frac{f^{(w)}(m)}{\tau_{fr}}\label{s10-24}\\
\tau_{fr}&=&\frac{\exp \bigl[b_{fr}(T_{0}-T)\bigr]}{a_{fr} m}\nonumber
\end{eqnarray}

where $a_{fr}=10^{-4}s^{-1}$, and $b_{fr}=0.66^{o}C^{-1}$ are emperical parameters, and $T_{0}$ is 273.15 $K$.\\
The eq. \ref{s10-24} can transfer to

\begin{eqnarray}
\frac{\partial g^{(w)(m)}}{\partial t}&=&-\frac{g^{(w)}(m)}{\tau_{fr}(m)}\label{s10-25}\\
\tau_{fr,i}&=&\frac{\exp\bigl (b_{fr}(T_{0}-T)\bigr )}{a_{fr}m}\nonumber
\end{eqnarray}

From this equation, The mass change of i-th bin during $\Delta t$ is given as

\begin{eqnarray}
g_{i}^{(w)}(t+\Delta t)=g_{i}^{(w)}-Frz_{i}\label{s10-25}\\
\left \{
\begin{array}{r}
g_{i}^{(plate)}(t+\Delta t)=g_{i}^{(plate)}+Frz_{i}\:\:\: (r_{w}<200\mu m)\\
g_{i}^{(hail)}(t+\Delta t)=g_{i}^{(hail)}+Frz_{i}\:\:\: (r_{w}>200\mu m)
\end{array} \right.\label{s10-26}\\
Frz_{i}=g_{i}^{(w)}(t)\Bigl [1-\exp\bigl (-\frac{\Delta t}{\tau_{fr,i}}\bigr )\bigr]\nonumber
\end{eqnarray}


 As shown in eq. \ref{s10-26}, the mass of liuid is transfer from to plate type ice ($r_{w}<200\mu m$) or hail ($r_{w}>200\mu m$).

\subsubsection{Melting}
The calculation of melting process is too simple way, that is, all ice particles (i.e. plate, columner, dendrite, snow, graupel and hail) melt immediately when the temperature is larger than $T_{0}=273.15$ $K$. This is too simply to represent ice phase process, and we will modify this method near future.

