% # -*- f90 -*-
% # vi: set sw=4 ts=8:
% types = %w(dry kessler tomita08 sn14 suzuki10 sdm)
!-------------------------------------------------------------------------------
!> module ATMOSPHERE / Physics Cloud Microphysics
!!
!! @par Description
!!         Cloud Microphysics
!!
!! @author Team SCALE
!!
!! @par History
!! @li      2013-12-06 (S.Nishizawa) [new]
!!
!<
! Warning: This file was generated from <%=__FILE__%>.
!          Do not edit this file.
!-------------------------------------------------------------------------------
module scale_atmos_phy_mp
  !-----------------------------------------------------------------------------
  !
  !++ used modules
  !
  use scale_precision
  use scale_stdio
  use scale_prof
  use scale_grid_index
  use scale_tracer
  !-----------------------------------------------------------------------------
  implicit none
  private
  !-----------------------------------------------------------------------------
  !
  !++ Public procedure
  !
  public :: ATMOS_PHY_MP_setup

  !-----------------------------------------------------------------------------
  !
  !++ Public parameters & variables
  !
  !-----------------------------------------------------------------------------
  !
  !++ Private procedure
  !
  !-----------------------------------------------------------------------------
  !
  !++ Private parameters & variables
  !
  abstract interface
     subroutine mp( &
          DENS, &
          MOMZ, &
          MOMX, &
          MOMY, &
          RHOT, &
          QTRC  )
       use scale_precision
       use scale_grid_index
       use scale_tracer
       real(RP), intent(inout) :: DENS(KA,IA,JA)
       real(RP), intent(inout) :: MOMZ(KA,IA,JA)
       real(RP), intent(inout) :: MOMX(KA,IA,JA)
       real(RP), intent(inout) :: MOMY(KA,IA,JA)
       real(RP), intent(inout) :: RHOT(KA,IA,JA)
       real(RP), intent(inout) :: QTRC(KA,IA,JA,QA)
     end subroutine mp
     subroutine cf( &
          cldfrac, &
          QTRC     )
       use scale_precision
       use scale_grid_index
       use scale_tracer
       real(RP), intent(out) :: cldfrac(KA,IA,JA)
       real(RP), intent(in)  :: QTRC   (KA,IA,JA,QA)
     end subroutine cf
     subroutine er( &
          Re,    &
          QTRC0, &
          DENS0  )
       use scale_precision
       use scale_grid_index
       use scale_tracer
       real(RP), intent(out) :: Re   (KA,IA,JA,MP_QA) ! effective radius
       real(RP), intent(in)  :: QTRC0(KA,IA,JA,QA)    ! tracer mass concentration [kg/kg]
       real(RP), intent(in)  :: DENS0(KA,IA,JA)       ! density
     end subroutine er
     subroutine mr( &
          Qe,    &
          QTRC0  )
       use scale_precision
       use scale_grid_index
       use scale_tracer
       real(RP), intent(out) :: Qe   (KA,IA,JA,MP_QA) ! mixing ratio of each cateory [kg/kg]
       real(RP), intent(in)  :: QTRC0(KA,IA,JA,QA)    ! tracer mass concentration [kg/kg]
     end subroutine mr
  end interface
  procedure(mp), pointer :: ATMOS_PHY_MP => NULL()
  procedure(cf), pointer :: ATMOS_PHY_MP_CloudFraction => NULL()
  procedure(er), pointer :: ATMOS_PHY_MP_EffectiveRadius => NULL()
  procedure(mr), pointer :: ATMOS_PHY_MP_MixingRatio => NULL()
  public :: ATMOS_PHY_MP
  public :: ATMOS_PHY_MP_CloudFraction
  public :: ATMOS_PHY_MP_EffectiveRadius
  public :: ATMOS_PHY_MP_MixingRatio

  real(RP), pointer, public :: ATMOS_PHY_MP_DENS(:)

  !-----------------------------------------------------------------------------
contains
  !-----------------------------------------------------------------------------
  !> Setup Cloud Microphysics
  !-----------------------------------------------------------------------------
  subroutine ATMOS_PHY_MP_setup( MP_TYPE )
    use scale_process, only: &
       PRC_MPIstop
    use scale_tracer, only: &
       QAD => QA
#define EXTM(pre, name, post) pre ## name ## post
#define NAME(pre, name, post) EXTM(pre, name, post)
#ifdef MP
    use NAME(scale_atmos_phy_mp_, MP,), only: &
       NAME(ATMOS_PHY_MP_, MP, _setup), &
       NAME(ATMOS_PHY_MP_, MP,), &
       NAME(ATMOS_PHY_MP_, MP, _CloudFraction), &
       NAME(ATMOS_PHY_MP_, MP, _EffectiveRadius), &
       NAME(ATMOS_PHY_MP_, MP, _MixingRatio), &
       NAME(ATMOS_PHY_MP_, MP, _DENS) => ATMOS_PHY_MP_DENS)
#else
% types.each do |type|
    use scale_atmos_phy_mp_<%=type%>, only: &
       ATMOS_PHY_MP_<%=type%>_setup, &
       ATMOS_PHY_MP_<%=type%>, &
       ATMOS_PHY_MP_<%=type%>_CloudFraction, &
       ATMOS_PHY_MP_<%=type%>_EffectiveRadius, &
       ATMOS_PHY_MP_<%=type%>_MixingRatio, &
       ATMOS_PHY_MP_<%=type%>_DENS => ATMOS_PHY_MP_DENS
% end
#endif
    implicit none
    character(len=H_SHORT), intent(in) :: MP_TYPE
    !---------------------------------------------------------------------------

    select case ( MP_TYPE )
% types.each do |type|
    case ( '<%=type.upcase%>' )
       call ATMOS_PHY_MP_<%=type%>_setup( MP_TYPE )
       ATMOS_PHY_MP => ATMOS_PHY_MP_<%=type%>
       ATMOS_PHY_MP_CloudFraction => ATMOS_PHY_MP_<%=type%>_CloudFraction
       ATMOS_PHY_MP_EffectiveRadius => ATMOS_PHY_MP_<%=type%>_EffectiveRadius
       ATMOS_PHY_MP_MixingRatio => ATMOS_PHY_MP_<%=type%>_MixingRatio
       ATMOS_PHY_MP_DENS => ATMOS_PHY_MP_<%=type%>_DENS
% end
    end select

    return
  end subroutine ATMOS_PHY_MP_setup

end module scale_atmos_phy_mp
